"use strict";(self.webpackChunktraders=self.webpackChunktraders||[]).push([[380],{67928:(B,h,r)=>{r.r(h),r.d(h,{ReportCollectionsModule:()=>I});var p=r(36895),C=r(4973),u=r(64575),i=r(90433),_=r(15439),t=r(94650),v=r(49651),T=r(32566),A=r(30901),y=r(31883),x=r(21102),f=r(73679),m=r(36704),g=r(35635),z=r(38231),Z=r(66616),F=r(47044),S=r(21811),b=r(37096),N=r(5259),c=r(44688);function R(n,a){if(1&n&&t._UZ(0,"nz-option",27),2&n){const o=a.$implicit;t.Q6J("nzLabel",o)("nzValue",o)}}function U(n,a){if(1&n){const o=t.EpF();t.TgZ(0,"button",28),t.NdJ("click",function(){t.CHM(o);const s=t.oxw().index,l=t.oxw();return t.KtG(l.removeField(s))}),t._uU(1,"remove"),t.qZA()}}function J(n,a){if(1&n&&(t.TgZ(0,"div",23)(1,"nz-form-item")(2,"nz-form-label",6)(3,"span"),t._uU(4,"Reason Type"),t.qZA()(),t.TgZ(5,"nz-form-control",6)(6,"nz-select",24),t.YNc(7,R,1,2,"nz-option",25),t.qZA()()(),t.YNc(8,U,2,0,"button",26),t.qZA()),2&n){const o=t.oxw();t.xp6(2),t.Q6J("nzSm",6)("nzXs",24),t.xp6(3),t.Q6J("nzSm",14)("nzXs",24),t.xp6(1),t.Q6J("nzAutoFocus",!0),t.xp6(1),t.Q6J("ngForOf",o.reasonTypes),t.xp6(1),t.Q6J("ngIf",o.reasonType.controls.length>1)}}function M(n,a){if(1&n){const o=t.EpF();t.TgZ(0,"span",30),t.NdJ("click",function(){t.CHM(o);const s=t.oxw(2);return t.KtG(s.clearfield("notes"))}),t.qZA()}}function O(n,a){if(1&n&&t.YNc(0,M,1,0,"span",29),2&n){const o=t.oxw();t.Q6J("ngIf",o.validateForm.controls.notes.value)}}function Q(n,a){if(1&n&&(t.TgZ(0,"tr")(1,"td"),t._uU(2),t.qZA(),t.TgZ(3,"td"),t._uU(4),t.qZA(),t.TgZ(5,"td"),t._uU(6),t.qZA(),t.TgZ(7,"td"),t._uU(8),t.qZA(),t.TgZ(9,"td"),t._uU(10),t.qZA(),t.TgZ(11,"td"),t._uU(12),t.qZA()()),2&n){const o=a.$implicit;t.xp6(2),t.Oqu(o.created_name),t.xp6(2),t.Oqu(o.amount),t.xp6(2),t.Oqu(o.date),t.xp6(2),t.Oqu(o.reason_type),t.xp6(2),t.Oqu(o.spent_amount),t.xp6(2),t.Oqu(o.notes)}}function D(n,a){if(1&n&&(t.TgZ(0,"nz-table",31,32)(2,"thead")(3,"tr")(4,"th"),t._uU(5,"Name"),t.qZA(),t.TgZ(6,"th"),t._uU(7,"Amount"),t.qZA(),t.TgZ(8,"th"),t._uU(9,"Date"),t.qZA(),t.TgZ(10,"th"),t._uU(11,"Spent Reason"),t.qZA(),t.TgZ(12,"th"),t._uU(13,"Spent Amount"),t.qZA(),t.TgZ(14,"th"),t._uU(15,"Notes"),t.qZA()()(),t.TgZ(16,"tbody"),t.YNc(17,Q,13,6,"tr",33),t.qZA()()),2&n){const o=t.oxw();t.Q6J("nzData",o.collectionsData)("nzLoading",o.loading)("nzShowPagination",!1),t.xp6(17),t.Q6J("ngForOf",o.collectionsData)}}const q=[{path:"",component:(()=>{class n{constructor(o,e,s,l,d,P){this.fb=o,this.message=e,this.mainService=s,this.exportAsService=l,this.router=d,this.farmerService=P,this.collectionsData=[],this.sort=["ascend"],this.listOfColumns=[{name:"Name"},{phoneNumber:"Phone Number"},{address:"Address"},{notes:"Note"}],this.index=1,this.total=0,this.pageSize=10,this.loading=!1,this.edit=!1,this.downloadAs="pdf",this.exportAsConfig={type:"pdf",elementIdOrContent:"sampleTable"},this.customers=[],this.reasonTypes=["Petrol","Farmer","Transport","Cooli"],this.totalCollectedAmount=0,this.date=new Date,this.dateDisable=!1,this.dateFormat="dd-MM-yyyy",this.userinfo=this.mainService.getLoggedInUser(),this.validateForm=this.fb.group({amount:[null,[i.kI.required]],notes:[null],date:[this.date,[i.kI.required]],reasonType:this.fb.array([this.addReasonTpes()])}),"admin"!==this.userinfo.username&&(this.dateDisable=!0)}get reasonType(){return this.validateForm.get("reasonType")}addReasonTpes(){return this.fb.group({reason_type:new i.NI(""),reason_amount:new i.NI("")})}addfield(){this.reasonType.push(this.addReasonTpes())}removeField(o){this.reasonType.length>1&&this.reasonType.removeAt(o)}ngOnInit(){this.getAllFarmers(),this.getcollection_reports()}submitForm(){}clearfield(o){this.validateForm.controls[o].reset()}reset(){this.validateForm.controls.amount.reset(),this.validateForm.controls.notes.reset()}exportToExcel(){let o=[];this.collectionsData.forEach(s=>{o.push({Name:s.name,"Phone Number":s.phone_number,Address:s.address,Notes:s.notes})}),this.exportAsConfig.type=this.downloadAs,this.exportAsConfig.elementIdOrContent="<table><thead><tr><th>Name</th><th>Balance Amount</th><th>Paid Amount</th></tr></thead><tbody><tr><td>Rajesh</td><td>1500</td><td>500</td></tr><tr><td>Customer1</td><td>0</td><td>0</td></tr></tbody></table>",this.exportAsConfig.options={margins:{top:"50"}},this.exportAsService.save(this.exportAsConfig,"customers").subscribe(()=>{})}editCustomer(o){this.edit=!0,this.customerId=o._id,this.validateForm.controls.phoneNumber.setValue(o.phone_number),this.validateForm.controls.name.setValue(o.name),this.validateForm.controls.notes.setValue(o.notes),this.validateForm.controls.address.setValue(o.address)}deleteConfirm(o){this.mainService.removeCustomer(o).subscribe(e=>{this.loading=!1,e&&e.success?this.message.create("success",e.message):e.success||this.message.create("warning",e.message)},e=>{console.log("get customers err ",e),this.loading=!1,e&&e.error&&!e.error.success&&1e3===e.error.code&&(this.message.create("error",e.error.message),sessionStorage.clear(),this.router.navigateByUrl("/login"))})}cancel(){}onPageSizeChange(o){this.pageSize=o}onPageChange(o){this.index=o}getAllFarmers(){document.getElementById("farmerName")?.focus(),this.farmerService.getFarmers({}).subscribe(e=>{this.farmersData=e.data,this.total=e.total},e=>{console.log("get farmers err ",e),this.farmersData=[],e&&e.error&&!e.error.success&&1e3===e.error.code&&(this.message.create("error",e.error.message),sessionStorage.clear(),this.router.navigateByUrl("/login"))})}getcollection_reports(){this.mainService.getcollection_reports({}).subscribe(e=>{console.log("data: ",e),this.collectionsData=e},e=>{console.log("get collection_reports err ",e),e&&e.error&&!e.error.success&&1e3===e.error.code&&(this.message.create("error",e.error.message),sessionStorage.clear(),this.router.navigateByUrl("/login"))})}getCollectionAmountByUser(o){this.mainService.getCollectionAmountByUser({collection_date:o}).subscribe(e=>{this.totalCollectedAmount=e.collectedAmount,_(new Date).format("DD-MM-YYYY");const d=this.validateForm.value.amount+(this.validateForm.value.reason_amount||0);console.log("useramount: ",d),console.log("this.totalCollectedAmount: ",this.totalCollectedAmount),this.totalCollectedAmount===d?this.message.create("info","okay"):this.message.create("error","not okay")},e=>{console.log("getCollectionAmountByUser err ",e),e&&e.error&&!e.error.success&&1e3===e.error.code&&(this.message.create("error",e.error.message),sessionStorage.clear(),this.router.navigateByUrl("/login"))})}onChange(o){}}return n.\u0275fac=function(o){return new(o||n)(t.Y36(i.QS),t.Y36(v.dD),t.Y36(T.J),t.Y36(A.f),t.Y36(u.F0),t.Y36(y.y))},n.\u0275cmp=t.Xpm({type:n,selectors:[["app-report-collections"]],decls:39,vars:27,consts:[[1,"customer-form"],["nz-row",""],["nz-col","","nzSpan","24"],[1,"text-center"],["nz-col","","nzSpan","12"],["nz-form","",3,"formGroup"],[3,"nzSm","nzXs"],["formControlName","date",3,"ngModel","nzAllowClear","nzDisabled","nzFormat","ngModelChange"],["nzFor","amount","nzRequired","",3,"nzSm","nzXs"],["nzErrorTip","Enter Amount",3,"nzSm","nzXs"],["type","number","id","amount","formControlName","amount",3,"nzMin","nzStep"],["formArrayName","reasonType",4,"ngFor","ngForOf"],["nz-button","","nzType","primary",3,"click"],["nzFor","notes",3,"nzSm","nzXs"],["nzErrorTip","Please input your notes!",3,"nzSm","nzXs","nzValidateStatus"],[1,"ant-input-affix-wrapper-textarea-with-clear-btn",3,"nzSuffix"],["nz-input","","formControlName","notes","placeholder","Notes"],["textAreaClearNotes",""],["nz-row","",1,"register-area"],[3,"nzSpan","nzOffset"],["nz-button","","nzType","primary",3,"disabled","click"],["nz-button","","nzType","default",3,"click"],[3,"nzData","nzLoading","nzShowPagination",4,"ngIf"],["formArrayName","reasonType"],["nzShowSearch","","nzAllowClear","","formControlName","reason_type",3,"nzAutoFocus"],[3,"nzLabel","nzValue",4,"ngFor","ngForOf"],["nz-button","","nzType","primary","style","float: right;",3,"click",4,"ngIf"],[3,"nzLabel","nzValue"],["nz-button","","nzType","primary",2,"float","right",3,"click"],["nz-icon","","class","ant-input-clear-icon","nzTheme","fill","nzType","close-circle",3,"click",4,"ngIf"],["nz-icon","","nzTheme","fill","nzType","close-circle",1,"ant-input-clear-icon",3,"click"],[3,"nzData","nzLoading","nzShowPagination"],["customerTable",""],[4,"ngFor","ngForOf"]],template:function(o,e){if(1&o&&(t.TgZ(0,"div",0)(1,"div",1)(2,"div",2)(3,"h2",3),t._uU(4,"Collection Report"),t.qZA()()(),t.TgZ(5,"div",1)(6,"div",4)(7,"form",5)(8,"nz-form-item")(9,"nz-form-label",6),t._uU(10,"Date"),t.qZA(),t.TgZ(11,"nz-form-control",6)(12,"nz-date-picker",7),t.NdJ("ngModelChange",function(l){return e.date=l})("ngModelChange",function(l){return e.onChange(l)}),t.qZA()()(),t.TgZ(13,"nz-form-item")(14,"nz-form-label",8)(15,"span"),t._uU(16,"Amount"),t.qZA()(),t.TgZ(17,"nz-form-control",9),t._UZ(18,"nz-input-number",10),t.qZA()(),t.YNc(19,J,9,7,"div",11),t.TgZ(20,"button",12),t.NdJ("click",function(){return e.addfield()}),t._uU(21,"Add"),t.qZA(),t.TgZ(22,"nz-form-item")(23,"nz-form-label",13),t._uU(24,"Notes"),t.qZA(),t.TgZ(25,"nz-form-control",14)(26,"nz-input-group",15),t._UZ(27,"textarea",16),t.qZA(),t.YNc(28,O,1,1,"ng-template",null,17,t.W1O),t.qZA()(),t.TgZ(30,"nz-form-item",18)(31,"nz-form-control",19)(32,"button",20),t.NdJ("click",function(){return e.submitForm()}),t._uU(33),t.qZA(),t._uU(34,"\xa0 "),t.TgZ(35,"button",21),t.NdJ("click",function(){return e.reset()}),t._uU(36,"Reset"),t.qZA()()()()(),t.TgZ(37,"div",4),t.YNc(38,D,18,4,"nz-table",22),t.qZA()()()),2&o){const s=t.MAs(29);t.xp6(7),t.Q6J("formGroup",e.validateForm),t.xp6(2),t.Q6J("nzSm",6)("nzXs",24),t.xp6(2),t.Q6J("nzSm",14)("nzXs",24),t.xp6(1),t.Q6J("ngModel",e.date)("nzAllowClear",!1)("nzDisabled",e.dateDisable)("nzFormat",e.dateFormat),t.xp6(2),t.Q6J("nzSm",6)("nzXs",24),t.xp6(3),t.Q6J("nzSm",14)("nzXs",24),t.xp6(1),t.Q6J("nzMin",0)("nzStep",1),t.xp6(1),t.Q6J("ngForOf",e.reasonType.controls),t.xp6(4),t.Q6J("nzSm",6)("nzXs",24),t.xp6(2),t.Q6J("nzSm",14)("nzXs",24)("nzValidateStatus",e.validateForm.controls.notes),t.xp6(1),t.Q6J("nzSuffix",s),t.xp6(5),t.Q6J("nzSpan",14)("nzOffset",6),t.xp6(1),t.Q6J("disabled",!e.validateForm.valid),t.xp6(1),t.Oqu(e.edit?"Update":"Submit"),t.xp6(5),t.Q6J("ngIf",e.collectionsData)}},dependencies:[p.sg,p.O5,x.Ls,f.t3,f.SK,m.Lr,m.Nx,m.iK,m.Fd,i._Y,i.Fj,i.JJ,i.JL,i.sg,i.u,i.CE,g.Zp,g.gB,g.ke,z.Ip,z.Vq,Z.ix,F.w,S.dQ,b._V,N.uw,c.N8,c.Uo,c._C,c.Om,c.p0,c.$Z],styles:["[nz-form][_ngcontent-%COMP%]{max-width:600px}.phone-select[_ngcontent-%COMP%]{width:70px}.register-are[_ngcontent-%COMP%]{margin-bottom:8px}.customer-form[_ngcontent-%COMP%]{margin-top:20px}.text-center[_ngcontent-%COMP%]{text-align:center!important}.text-right[_ngcontent-%COMP%]{text-align:right!important}.reason_type_custom[_ngcontent-%COMP%]{width:100%;margin-left:10%}"]}),n})()}];let Y=(()=>{class n{}return n.\u0275fac=function(o){return new(o||n)},n.\u0275mod=t.oAB({type:n}),n.\u0275inj=t.cJS({imports:[u.Bz.forChild(q),u.Bz]}),n})(),I=(()=>{class n{}return n.\u0275fac=function(o){return new(o||n)},n.\u0275mod=t.oAB({type:n}),n.\u0275inj=t.cJS({imports:[p.ez,Y,C.m]}),n})()}}]);