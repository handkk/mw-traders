"use strict";(self.webpackChunktraders=self.webpackChunktraders||[]).push([[595],{31595:(R,f,s)=>{s.r(f),s.d(f,{BillModule:()=>P});var u=s(36895),g=s(64575),a=s(90433),p=s(15439),e=s(94650),b=s(49651),S=s(32566),C=s(31883),Z=s(37570),T=s(21102),z=s(73679),d=s(36704),h=s(35635),_=s(38231),x=s(66616),A=s(47044),B=s(21811),y=s(37096),F=s(5259),c=s(44688),q=s(6497),M=s(21243);function J(o,l){if(1&o&&e._UZ(0,"nz-option",39),2&o){const n=l.$implicit;e.Q6J("nzLabel",n.name)("nzValue",n)}}function U(o,l){if(1&o&&e._UZ(0,"nz-option",39),2&o){const n=l.$implicit;e.Q6J("nzLabel",n.name)("nzValue",n)}}function O(o,l){if(1&o&&e._UZ(0,"nz-option",39),2&o){const n=l.$implicit;e.Q6J("nzLabel",n.name)("nzValue",n)}}function Q(o,l){if(1&o){const n=e.EpF();e.TgZ(0,"span",41),e.NdJ("click",function(){e.CHM(n);const i=e.oxw(3);return e.KtG(i.clearfield("notes"))}),e.qZA()}}function w(o,l){if(1&o&&e.YNc(0,Q,1,0,"span",40),2&o){const n=e.oxw(2);e.Q6J("ngIf",n.validateForm.controls.notes.value)}}const D=function(){return{standalone:!0}};function N(o,l){if(1&o){const n=e.EpF();e.TgZ(0,"form",11),e.NdJ("ngSubmit",function(){e.CHM(n);const i=e.oxw();return e.KtG(i.submitForm())}),e.TgZ(1,"div",1)(2,"div",12)(3,"nz-form-item")(4,"nz-form-label",13),e._uU(5,"Date"),e.qZA(),e.TgZ(6,"nz-form-control",13)(7,"nz-date-picker",14),e.NdJ("ngModelChange",function(i){e.CHM(n);const r=e.oxw();return e.KtG(r.date=i)})("ngModelChange",function(i){e.CHM(n);const r=e.oxw();return e.KtG(r.onChange(i))}),e.qZA()()()()(),e.TgZ(8,"div",1)(9,"div",12)(10,"nz-form-item")(11,"nz-form-label",15)(12,"span"),e._uU(13,"Customer"),e.qZA()(),e.TgZ(14,"nz-form-control",13)(15,"nz-select",16),e.YNc(16,J,1,2,"nz-option",17),e.qZA()()()()(),e.TgZ(17,"div",1)(18,"div",12)(19,"nz-form-item")(20,"nz-form-label",18)(21,"span"),e._uU(22,"Quantity"),e.qZA()(),e.TgZ(23,"nz-form-control",19),e._UZ(24,"nz-input-number",20),e.qZA()()()(),e.TgZ(25,"div",1)(26,"div",12)(27,"nz-form-item")(28,"nz-form-label",21)(29,"span"),e._uU(30,"Rate"),e.qZA()(),e.TgZ(31,"nz-form-control",22),e._UZ(32,"nz-input-number",23),e.qZA()()(),e.TgZ(33,"div",24)(34,"nz-form-item")(35,"nz-form-label",13)(36,"span"),e._uU(37,"Unit wise"),e.qZA()(),e.TgZ(38,"nz-form-control",13)(39,"nz-switch",25),e.NdJ("ngModelChange",function(i){e.CHM(n);const r=e.oxw();return e.KtG(r.switchValue=i)}),e.qZA()()()()(),e.TgZ(40,"div",1)(41,"div",12)(42,"nz-form-item")(43,"nz-form-label",26)(44,"span"),e._uU(45,"Vegetables"),e.qZA()(),e.TgZ(46,"nz-form-control",13)(47,"nz-select",27),e.YNc(48,U,1,2,"nz-option",17),e.qZA()()()()(),e.TgZ(49,"div",1)(50,"div",12)(51,"nz-form-item")(52,"nz-form-label",28)(53,"span"),e._uU(54,"Farmer"),e.qZA()(),e.TgZ(55,"nz-form-control",13)(56,"nz-select",29),e.YNc(57,O,1,2,"nz-option",17),e.qZA()()()()(),e.TgZ(58,"div",1)(59,"div",12)(60,"nz-form-item")(61,"nz-form-label",30),e._uU(62,"Notes"),e.qZA(),e.TgZ(63,"nz-form-control",31)(64,"nz-input-group",32),e._UZ(65,"textarea",33),e.qZA(),e.YNc(66,w,1,1,"ng-template",null,34,e.W1O),e.qZA()()()(),e.TgZ(68,"div",1)(69,"div",35)(70,"nz-form-item",36)(71,"nz-form-control")(72,"button",37),e._uU(73),e.qZA(),e._uU(74,"\xa0 "),e.TgZ(75,"button",38),e.NdJ("click",function(){e.CHM(n);const i=e.oxw();return e.KtG(i.reset())}),e._uU(76,"Reset"),e.qZA()()()()()()}if(2&o){const n=e.MAs(67),t=e.oxw();e.Q6J("formGroup",t.validateForm),e.xp6(4),e.Q6J("nzSm",6)("nzXs",24),e.xp6(2),e.Q6J("nzSm",14)("nzXs",24),e.xp6(1),e.Q6J("ngModel",t.date)("nzAllowClear",!1)("nzDisabled",t.dateDisable)("nzFormat",t.dateFormat),e.xp6(4),e.Q6J("nzSm",6)("nzXs",24),e.xp6(3),e.Q6J("nzSm",14)("nzXs",24),e.xp6(1),e.Q6J("nzAutoFocus",!0),e.xp6(1),e.Q6J("ngForOf",t.customers),e.xp6(4),e.Q6J("nzSm",6)("nzXs",24),e.xp6(3),e.Q6J("nzSm",14)("nzXs",24),e.xp6(1),e.Q6J("nzMin",1)("nzStep",1),e.xp6(4),e.Q6J("nzSm",6)("nzXs",24),e.xp6(3),e.Q6J("nzSm",14)("nzXs",24),e.xp6(1),e.Q6J("nzMin",1)("nzStep",1),e.xp6(3),e.Q6J("nzSm",6)("nzXs",24),e.xp6(3),e.Q6J("nzSm",14)("nzXs",24),e.xp6(1),e.Q6J("ngModel",t.switchValue)("ngModelOptions",e.DdM(52,D)),e.xp6(4),e.Q6J("nzSm",6)("nzXs",24),e.xp6(3),e.Q6J("nzSm",14)("nzXs",24),e.xp6(2),e.Q6J("ngForOf",t.vegetablesList),e.xp6(4),e.Q6J("nzSm",6)("nzXs",24),e.xp6(3),e.Q6J("nzSm",14)("nzXs",24),e.xp6(2),e.Q6J("ngForOf",t.farmersList),e.xp6(4),e.Q6J("nzSm",6)("nzXs",24),e.xp6(2),e.Q6J("nzSm",14)("nzXs",24)("nzValidateStatus",t.validateForm.controls.notes),e.xp6(1),e.Q6J("nzSuffix",n),e.xp6(5),e.Q6J("nzSpan",12)("nzOffset",6),e.xp6(4),e.Oqu(t.edit?"Update":"Create")}}function V(o,l){if(1&o&&(e.TgZ(0,"p",42)(1,"strong"),e._uU(2,"Total Quantity:"),e.qZA(),e._uU(3),e.TgZ(4,"strong"),e._uU(5,"Total Amount:"),e.qZA(),e._uU(6),e.ALo(7,"number"),e.qZA()),2&o){const n=e.oxw();e.xp6(3),e.hij(" ",n.total_quantity," \xa0\xa0 "),e.xp6(3),e.hij(" ",e.xi3(7,2,n.total_amount,"1.2-2")," \xa0\xa0\xa0")}}function I(o,l){if(1&o){const n=e.EpF();e.TgZ(0,"a",44),e.NdJ("nzOnConfirm",function(){e.CHM(n);const i=e.oxw().$implicit,r=e.oxw();return e.KtG(r.deleteConfirm(i._id))})("nzOnCancel",function(){e.CHM(n);const i=e.oxw(2);return e.KtG(i.cancel())}),e._UZ(1,"span",45),e.qZA()}}function X(o,l){if(1&o&&(e.TgZ(0,"tr")(1,"td"),e._uU(2),e.qZA(),e.TgZ(3,"td"),e._uU(4),e.qZA(),e.TgZ(5,"td"),e._uU(6),e.qZA(),e.TgZ(7,"td"),e._uU(8),e.qZA(),e.TgZ(9,"td"),e._uU(10),e.ALo(11,"number"),e.qZA(),e.TgZ(12,"td"),e._uU(13),e.ALo(14,"number"),e.qZA(),e.TgZ(15,"td"),e.YNc(16,I,2,0,"a",43),e.qZA()()),2&o){const n=l.$implicit,t=l.index,i=e.oxw();e.xp6(2),e.Oqu(i.billsData.length-t),e.xp6(2),e.Oqu(n.customer_name),e.xp6(2),e.Oqu(n.vegetable_name),e.xp6(2),e.Oqu(n.quantity),e.xp6(2),e.Oqu(e.xi3(11,7,n.rate,"1.2-2")),e.xp6(3),e.Oqu(e.xi3(14,10,n.total_amount,"1.2-2")),e.xp6(3),e.Q6J("ngIf","admin"===i.userinfo.username||(null==i.userinfo||null==i.userinfo.apps?null:i.userinfo.apps.bill)&&(null==i.userinfo||null==i.userinfo.apps||null==i.userinfo.apps.bill?null:i.userinfo.apps.bill.isEdit))}}const Y=[{path:"",component:(()=>{class o{constructor(n,t,i,r,m,E){this.fb=n,this.el=t,this.message=i,this.mainService=r,this.farmerService=m,this.router=E,this.customers=[],this.vegetablesList=[],this.farmersList=[],this.date=new Date,this.defaultDate=new Date,this.billsData=[],this.sort=["ascend"],this.listOfColumns=[{name:"Name",sortOrder:"ascend"},{item:"Item",sortOrder:null},{rate:"Rate",sortOrder:null},{quantity:"quantity",sortOrder:null}],this.index=1,this.total=0,this.pageSize=20,this.loading=!0,this.edit=!1,this.switchValue=!1,this.dateDisable=!1,this.dateFormat="dd-MM-yyyy",this.total_quantity=0,this.total_amount=0,this.bill_date=new Date,this.userinfo=this.mainService.getLoggedInUser(),this.userinfo?"admin"!==this.userinfo.username&&((this.userinfo?.apps?.bill?.isView||this.userinfo?.apps?.bill?.isEdit)&&this.userinfo?.apps?.bill?.isView||this.router.navigateByUrl("/main")):(sessionStorage.clear(),this.message.create("warning","User session expired please login"),this.router.navigateByUrl("/login"))}ngAfterViewInit(){}ngOnInit(){this.validateForm=this.fb.group({customer:[null,[a.kI.required]],quantity:[null,[a.kI.required]],rate:[null,[a.kI.required]],vegetables:[null,[a.kI.required]],farmer:[null,[a.kI.required]],date:[this.date,[a.kI.required]],notes:[null]}),this.total=this.billsData.length;const n=sessionStorage.getItem("userinfo");"admin"!==JSON.parse(n).username&&(this.dateDisable=!0),this.getCustomers(),this.getAllFarmers(),this.getAllVegetables(),this.getBills(),this.switchValue=!1,setTimeout(()=>{document.getElementById("customerSelection")?.children[0].children[0]?.children[0].setAttribute("id","customerselect"),document.getElementById("customerselect")?.focus()},500)}clearfield(n){this.validateForm.controls[n].reset()}getBills(){this.total_amount=0,this.total_quantity=0;const n={bill_date:p(this.bill_date).format("DD-MM-YYYY")};this.mainService.spinning.emit(!0),this.loading=!0,this.mainService.getBills(n).subscribe(t=>{this.billsData=t.data,this.total=t.total,this.mainService.spinning.emit(!1),this.loading=!1,this.billsData.forEach(r=>{this.total_quantity=this.total_quantity+r.quantity,this.total_amount=this.total_amount+r.total_amount})},t=>{console.log("get customers err ",t),this.billsData=[],this.mainService.spinning.emit(!1),this.loading=!1,t&&t.error&&!t.error.success&&1e3===t.error.code&&(this.message.create("error",t.error.message),sessionStorage.clear(),this.router.navigateByUrl("/login"))})}removeDuplicates(n,t){return[...new Map(n.map(i=>[t(i),i])).values()]}getCustomers(){this.mainService.getCustomers({}).subscribe(t=>{this.customers=t.data},t=>{console.log("get customers err ",t),this.customers=[],t&&t.error&&!t.error.success&&1e3===t.error.code&&(this.message.create("error",t.error.message),sessionStorage.clear(),this.router.navigateByUrl("/login"))})}getAllFarmers(){this.farmerService.getFarmers({}).subscribe(t=>{this.farmersList=t.data},t=>{console.log("get farmers err ",t),this.farmersList=[],t&&t.error&&!t.error.success&&1e3===t.error.code&&(this.message.create("error",t.error.message),sessionStorage.clear(),this.router.navigateByUrl("/login"))})}getAllVegetables(){this.mainService.getVegetables({}).subscribe(t=>{this.vegetablesList=t.data},t=>{console.log("get customers err ",t),this.vegetablesList=[],t&&t.error&&!t.error.success&&1e3===t.error.code&&(this.message.create("error",t.error.message),sessionStorage.clear(),this.router.navigateByUrl("/login"))})}clickSwitch(){this.switchValue=!this.switchValue}submitForm(){if(this.validateForm.valid){const n=p(this.validateForm.value.date).format("DD-MM-YYYY"),t={bill_date:this.edit?this.bill_data.bill_date:n,customer_name:this.validateForm.value.customer.name,customer_id:this.validateForm.value.customer._id,vegetable_name:this.validateForm.value.vegetables.name,vegetable_id:this.validateForm.value.vegetables._id,rate:this.validateForm.value.rate,quantity:this.validateForm.value.quantity,farmer_name:this.validateForm.value.farmer.name,farmer_id:this.validateForm.value.farmer._id,unit_wise:this.switchValue,notes:this.validateForm.value.notes,customer_balance_amount:this.validateForm.value.customer.balance_amount};this.mainService.spinning.emit(!0),this.edit?(t.isCustEdited=this.bill_data.customer_id!=this.validateForm.value.customer._id,t.oldCustId=this.bill_data.customer_id,this.mainService.updateBill(this.bill_data._id,t).subscribe(i=>{this.message.create("success","Bill updated Successfully"),this.mainService.spinning.emit(!1),this.validateForm.controls.quantity.reset(),this.validateForm.controls.notes.reset(),this.index=1,this.pageSize=10,this.edit=!1,this.date=new Date,this.getBills()},i=>{console.log("get customers err ",i),this.mainService.spinning.emit(!1),i&&i.error&&!i.error.success&&1e3===i.error.code&&(this.message.create("error",i.error.message),sessionStorage.clear(),this.router.navigateByUrl("/login"))})):this.mainService.createBill(t).subscribe(i=>{this.message.create("success","Bill added Successfully"),this.mainService.spinning.emit(!1),this.validateForm.controls.quantity.reset(),this.validateForm.controls.notes.reset(),this.index=1,this.pageSize=10,setTimeout(()=>{document.getElementById("customerSelection")?.children[0].children[0]?.children[0].setAttribute("id","customerselect"),document.getElementById("customerselect")?.focus()},500),this.getBills()},i=>{this.mainService.spinning.emit(!1),i&&i.error&&(i.error.success||1e3!==i.error.code?this.message.create("error",i.error.message):(this.message.create("error",i.error.message),sessionStorage.clear(),this.router.navigateByUrl("/login")))})}else this.mainService.spinning.emit(!1),Object.values(this.validateForm.controls).forEach(n=>{n.invalid&&(n.markAsDirty(),n.updateValueAndValidity({onlySelf:!0}))})}onChange(n){}reset(){this.validateForm.controls.quantity.reset(),this.validateForm.controls.rate.reset(),this.validateForm.controls.notes.reset(),this.edit=!1,this.switchValue=!1}deleteConfirm(n){this.loading=!0,this.mainService.spinning.emit(!0),this.mainService.removeBill(n).subscribe(t=>{this.loading=!1,this.mainService.spinning.emit(!1),t&&t.success&&(this.message.create("success",t.message),this.getBills())},t=>{console.log("get customers err ",t),this.loading=!1,this.mainService.spinning.emit(!1),t&&t.error&&!t.error.success&&1e3===t.error.code&&(this.message.create("error",t.error.message),sessionStorage.clear(),this.router.navigateByUrl("/login"))})}cancel(){}onPageSizeChange(n){this.pageSize=n,this.getBills()}onPageChange(n){this.index=n,this.getBills()}editBill(n){this.edit=!0,this.bill_data=n,this.billId=n._id,this.date=n.bill_date;let t=this.customers.find(m=>m._id===n.customer_id),i=this.vegetablesList.find(m=>m._id===n.vegetable_id),r=this.farmersList.find(m=>m._id===n.farmer_id);this.validateForm.controls.customer.setValue(t),this.validateForm.controls.notes.setValue(n.notes),this.validateForm.controls.quantity.setValue(n.quantity),this.validateForm.controls.rate.setValue(n.rate),this.validateForm.controls.vegetables.setValue(i),this.validateForm.controls.farmer.setValue(r),this.switchValue=n.unit_wise,this.dateDisable=!0}onBillChange(n){this.bill_date=n,this.getBills()}}return o.\u0275fac=function(n){return new(n||o)(e.Y36(a.QS),e.Y36(e.SBq),e.Y36(b.dD),e.Y36(S.J),e.Y36(C.y),e.Y36(g.F0))},o.\u0275cmp=e.Xpm({type:o,selectors:[["app-bill"]],decls:31,vars:10,consts:[[1,"customer-form"],["nz-row",""],["nz-col","","nzSpan","24"],[1,"text-center"],["nz-col","","nzSpan","12"],["nz-form","",3,"formGroup","ngSubmit",4,"ngIf"],["style","float: right;",4,"ngIf"],[3,"ngModel","nzAllowClear","nzDisabled","nzFormat","ngModelChange"],[3,"nzData","nzLoading","nzShowPagination"],["basicTable",""],[4,"ngFor","ngForOf"],["nz-form","",3,"formGroup","ngSubmit"],["nz-col","","nzSpan","14"],[3,"nzSm","nzXs"],["formControlName","date",3,"ngModel","nzAllowClear","nzDisabled","nzFormat","ngModelChange"],["nzRequired","",3,"nzSm","nzXs"],["nzShowSearch","","nzAllowClear","","formControlName","customer","id","customerSelection",3,"nzAutoFocus"],[3,"nzLabel","nzValue",4,"ngFor","ngForOf"],["nzFor","quantityNumber","nzRequired","",3,"nzSm","nzXs"],["nzErrorTip","Add quantity!",3,"nzSm","nzXs"],["id","quantityNumber","formControlName","quantity",3,"nzMin","nzStep"],["nzFor","rate","nzRequired","",3,"nzSm","nzXs"],["nzErrorTip","Add Rate!",3,"nzSm","nzXs"],["id","rate","formControlName","rate",3,"nzMin","nzStep"],["nz-col","","nzSpan","10"],[3,"ngModel","ngModelOptions","ngModelChange"],["nzFor","vegetables","nzRequired","",3,"nzSm","nzXs"],["nzShowSearch","","nzAllowClear","","formControlName","vegetables",1,"phone-selects"],["nzFor","farmer","nzRequired","",3,"nzSm","nzXs"],["nzShowSearch","","nzAllowClear","","formControlName","farmer",1,"phone-selects"],["nzFor","notes",3,"nzSm","nzXs"],["nzErrorTip","Please input your notes!",3,"nzSm","nzXs","nzValidateStatus"],[1,"ant-input-affix-wrapper-textarea-with-clear-btn",3,"nzSuffix"],["nz-input","","formControlName","notes","placeholder","Notes"],["textAreaClearNotes",""],["nz-col","",3,"nzSpan","nzOffset"],[1,"register-area"],["nz-button","","nzType","primary"],["nz-button","","nzType","default",3,"click"],[3,"nzLabel","nzValue"],["nz-icon","","class","ant-input-clear-icon","nzTheme","fill","nzType","close-circle",3,"click",4,"ngIf"],["nz-icon","","nzTheme","fill","nzType","close-circle",1,"ant-input-clear-icon",3,"click"],[2,"float","right"],["nz-popconfirm","","nzPopconfirmTitle","Are you sure delete this Bill","nzPopconfirmPlacement","bottom","nz-tooltip","","nzTooltipTitle","Remove Bill","nzTooltipPlacement","right",3,"nzOnConfirm","nzOnCancel",4,"ngIf"],["nz-popconfirm","","nzPopconfirmTitle","Are you sure delete this Bill","nzPopconfirmPlacement","bottom","nz-tooltip","","nzTooltipTitle","Remove Bill","nzTooltipPlacement","right",3,"nzOnConfirm","nzOnCancel"],["nz-icon","","nzType","delete","nzTheme","fill"]],template:function(n,t){1&n&&(e.TgZ(0,"div",0)(1,"div",1)(2,"div",2)(3,"h2",3),e._uU(4,"Customer Bills"),e.qZA()()(),e.TgZ(5,"div",1)(6,"div",4),e.YNc(7,N,77,53,"form",5),e.qZA(),e.TgZ(8,"div",4),e.YNc(9,V,8,5,"p",6),e.TgZ(10,"nz-date-picker",7),e.NdJ("ngModelChange",function(r){return t.bill_date=r})("ngModelChange",function(r){return t.onBillChange(r)}),e.qZA(),e.TgZ(11,"nz-table",8,9)(13,"thead")(14,"tr")(15,"th"),e._uU(16,"S.No."),e.qZA(),e.TgZ(17,"th"),e._uU(18,"Name"),e.qZA(),e.TgZ(19,"th"),e._uU(20,"Item"),e.qZA(),e.TgZ(21,"th"),e._uU(22,"Quantity"),e.qZA(),e.TgZ(23,"th"),e._uU(24,"Rate"),e.qZA(),e.TgZ(25,"th"),e._uU(26,"Total"),e.qZA(),e.TgZ(27,"th"),e._uU(28,"Actions"),e.qZA()()(),e.TgZ(29,"tbody"),e.YNc(30,X,17,13,"tr",10),e.qZA()()()()()),2&n&&(e.xp6(7),e.Q6J("ngIf","admin"===t.userinfo.username||t.userinfo.apps.bill&&t.userinfo.apps.bill.isEdit),e.xp6(2),e.Q6J("ngIf",t.billsData&&t.billsData.length>0),e.xp6(1),e.Q6J("ngModel",t.bill_date)("nzAllowClear",!1)("nzDisabled",t.dateDisable)("nzFormat",t.dateFormat),e.xp6(1),e.Q6J("nzData",t.billsData)("nzLoading",t.loading)("nzShowPagination",!1),e.xp6(19),e.Q6J("ngForOf",t.billsData))},dependencies:[u.sg,u.O5,Z.SY,T.Ls,z.t3,z.SK,d.Lr,d.Nx,d.iK,d.Fd,a._Y,a.Fj,a.JJ,a.JL,a.On,a.sg,a.u,h.Zp,h.gB,h.ke,_.Ip,_.Vq,x.ix,A.w,B.dQ,y._V,F.uw,c.N8,c.Uo,c._C,c.Om,c.p0,c.$Z,q.JW,M.i,u.JJ],styles:["[nz-form][_ngcontent-%COMP%]{max-width:600px}.phone-select[_ngcontent-%COMP%]{width:70px}.register-are[_ngcontent-%COMP%]{margin-bottom:8px}.customer-form[_ngcontent-%COMP%]{margin-top:20px}nz-date-picker[_ngcontent-%COMP%]{margin:0 8px 12px 0}.text-center[_ngcontent-%COMP%]{text-align:center!important}.text-right[_ngcontent-%COMP%]{text-align:right!important}  .ant-select-item-option-selected:not(.ant-select-item-option-disabled){background-color:green;color:#fff}  .ant-select-item-option-active:not(.ant-select-item-option-disabled){background-color:green;color:#fff}"]}),o})()}];let L=(()=>{class o{}return o.\u0275fac=function(n){return new(n||o)},o.\u0275mod=e.oAB({type:o}),o.\u0275inj=e.cJS({imports:[g.Bz.forChild(Y),g.Bz]}),o})();var v=s(4973);let P=(()=>{class o{}return o.\u0275fac=function(n){return new(n||o)},o.\u0275mod=e.oAB({type:o}),o.\u0275inj=e.cJS({imports:[u.ez,L,v.m,v.m]}),o})()}}]);