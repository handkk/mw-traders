"use strict";(self.webpackChunktraders=self.webpackChunktraders||[]).push([[956],{73956:(B,C,s)=>{s.r(C),s.d(C,{CustomerCollectionModule:()=>I});var c=s(36895),d=s(64575),r=s(90433),z=s(15439),f=s(37623),e=s(94650),_=s(49651),v=s(32566),S=s(21102),p=s(73679),u=s(36704),g=s(35635),h=s(38231),Z=s(66616),T=s(47044),A=s(21811),b=s(37096),M=s(5259),m=s(44688),x=s(6497),F=s(21634);function O(i,l){if(1&i&&e._UZ(0,"nz-option",31),2&i){const t=l.$implicit;e.Q6J("nzLabel",t.name)("nzValue",t)}}function y(i,l){if(1&i){const t=e.EpF();e.TgZ(0,"span",33),e.NdJ("click",function(){e.CHM(t);const o=e.oxw(2);return e.KtG(o.clearfield("notes"))}),e.qZA()}}function J(i,l){if(1&i&&e.YNc(0,y,1,0,"span",32),2&i){const t=e.oxw();e.Q6J("ngIf",t.validateForm.controls.notes.value)}}function D(i,l){if(1&i){const t=e.EpF();e.TgZ(0,"a",35),e.NdJ("nzOnConfirm",function(){e.CHM(t);const o=e.oxw().$implicit,a=e.oxw();return e.KtG(a.deleteConfirm(o._id))})("nzOnCancel",function(){e.CHM(t);const o=e.oxw(2);return e.KtG(o.cancel())}),e._UZ(1,"span",36),e.qZA()}}function P(i,l){if(1&i&&(e.TgZ(0,"tr")(1,"td"),e._uU(2),e.qZA(),e.TgZ(3,"td"),e._uU(4),e.qZA(),e.TgZ(5,"td"),e._uU(6),e.qZA(),e.TgZ(7,"td"),e._uU(8),e.ALo(9,"number"),e.qZA(),e.TgZ(10,"td"),e._uU(11),e.qZA(),e.TgZ(12,"td"),e.YNc(13,D,2,0,"a",34),e.qZA()()),2&i){const t=l.$implicit,n=l.index,o=e.oxw();e.xp6(2),e.Oqu(o.collectionsData.length-n),e.xp6(2),e.Oqu(t.collection_date),e.xp6(2),e.Oqu(t.customer_name),e.xp6(2),e.Oqu(e.xi3(9,6,t.amount,"1.2-2")),e.xp6(3),e.Oqu(t.notes),e.xp6(2),e.Q6J("ngIf","admin"===o.userinfo.username||o.userinfo.apps.collection&&o.userinfo.apps.collection.isEdit)}}const U=[{path:"",component:(()=>{class i{constructor(t,n,o,a,Q){this.fb=t,this.el=n,this.message=o,this.mainService=a,this.router=Q,this.customers=[{name:"Srinivas",id:"c1"},{name:"Sai",id:"c2"},{name:"Raju",id:"c3"},{name:"Chandu",id:"c4"}],this.vegetablesList=[{name:"Cabage",id:"v1"},{name:"Onion",id:"v2"},{name:"Potato",id:"v3"},{name:"Tomato",id:"v4"}],this.farmersList=[{name:"Teja",id:"f1"},{name:"Ravi",id:"f2"},{name:"Venkatesh",id:"f3"},{name:"Sai",id:"f4"}],this.date=new Date,this.defaultDate=new Date,this.collectionsData=[],this.sort=["ascend"],this.listOfColumns=[{name:"Name",sortOrder:"ascend"},{item:"Item",sortOrder:null},{rate:"Rate",sortOrder:null},{quantity:"quantity",sortOrder:null}],this.index=1,this.total=0,this.pageSize=10,this.loading=!1,this.selectedCustomer=null,this.total_amount=0,this.dateFormat="dd-MM-yyyy",this.dateDisable=!1,this.collections_date=new Date,this.disabledFDate=Y=>(0,f.Z)(Y,new Date)>0,this.userinfo=this.mainService.getLoggedInUser(),this.userinfo||(sessionStorage.clear(),this.message.create("warning","User session expired please login"),this.router.navigateByUrl("/login")),"admin"!==this.userinfo.username&&(this.dateDisable=!0)}ngOnInit(){this.validateForm=this.fb.group({customer:[null,[r.kI.required]],amount:[null,[r.kI.required]],date:[this.date,[r.kI.required]],notes:[null]}),this.getCustomers(),this.getCollections()}getCollections(){const t={skip:this.index,limit:this.pageSize,collection_date:z(this.collections_date).format("DD-MM-YYYY")};setTimeout(()=>{document.getElementById("collectionCustomerInput")?.children[0].children[0]?.children[0].setAttribute("id","collectionCustIn"),document.getElementById("collectionCustIn")?.focus()},500),this.loading=!0,this.mainService.getCollections(t).subscribe(n=>{this.collectionsData=n.data,this.total=n.total,this.loading=!1},n=>{this.collectionsData=[],this.loading=!1,n&&n.error&&!n.error.success&&1e3===n.error.code&&(this.message.create("error",n.error.message),sessionStorage.clear(),this.router.navigateByUrl("/login"))})}getCustomers(){this.mainService.getCustomers({}).subscribe(n=>{this.customers=n.data},n=>{console.log("get customers err ",n),this.customers=[]})}clearfield(t){this.validateForm.controls[t].reset()}submitForm(){if(this.validateForm.valid)if("admin"===this.userinfo.username||this.userinfo.apps.collection&&this.userinfo.apps.collection.isEdit){const t=z(this.validateForm.value.date).format("DD-MM-YYYY");this.mainService.createCollection({customer_name:this.validateForm.value.customer.name,customer_id:this.validateForm.value.customer._id,notes:this.validateForm.value.notes,amount:this.validateForm.value.amount,collection_date:t}).subscribe(o=>{this.message.create("success","Collection added Successfully"),this.reset(),this.loading=!0,this.selectedCustomer=null,this.getCollections(),setTimeout(()=>{this.getCustomers()},200)},o=>{this.loading=!1,o&&o.error?!o.error.success&&1e3===o.error.code&&(this.message.create("error",o.error.message),sessionStorage.clear(),this.router.navigateByUrl("/login")):this.getCollections()})}else this.message.create("warning","No Permission for Create Collection");else Object.values(this.validateForm.controls).forEach(t=>{t.invalid&&(t.markAsDirty(),t.updateValueAndValidity({onlySelf:!0}))})}reset(){this.validateForm.controls.amount.reset(),this.validateForm.controls.notes.reset()}onChange(t){}deleteConfirm(t){this.loading=!0,this.mainService.removeCollection(t).subscribe(n=>{this.loading=!1,n&&n.success&&(this.message.create("success",n.message),this.getCollections())},n=>{n&&n.error&&!n.error.success&&1e3===n.error.code&&(this.message.create("error",n.error.message),sessionStorage.clear(),this.router.navigateByUrl("/login")),this.loading=!1})}cancel(){}onPageSizeChange(t){this.pageSize=t,this.getCollections()}onPageChange(t){this.index=t,this.getCollections()}customerSelected(t){this.selectedCustomer=t}onDateChange(t){this.collections_date=t,this.index=1,this.getCollections()}}return i.\u0275fac=function(t){return new(t||i)(e.Y36(r.QS),e.Y36(e.SBq),e.Y36(_.dD),e.Y36(v.J),e.Y36(d.F0))},i.\u0275cmp=e.Xpm({type:i,selectors:[["app-customer-collection"]],decls:67,vars:46,consts:[[1,"customer-form"],["nz-row",""],["nz-col","","nzSpan","24"],[1,"text-center"],["nz-col","","nzSpan","12"],["nz-form","","appFocus","",3,"formGroup","ngSubmit"],["nzRequired","",3,"nzSm","nzXs"],[3,"nzSm","nzXs"],["formControlName","date",3,"ngModel","nzAllowClear","nzFormat","nzDisabled","ngModelChange"],[3,"nzSm","nzXs","nzExtra"],["nzShowSearch","","nzAllowClear","","formControlName","customer","id","collectionCustomerInput",3,"ngModel","ngModelChange"],["nzLabel","Select Customer","nzValue",""],[3,"nzLabel","nzValue",4,"ngFor","ngForOf"],["nzFor","amountCollection","nzRequired","",3,"nzSm","nzXs"],["nzErrorTip","Add amount!",3,"nzSm","nzXs"],["id","amountCollection","formControlName","amount",3,"nzMin","nzStep"],["nzFor","notes",3,"nzSm","nzXs"],["nzErrorTip","Please input your notes!",3,"nzSm","nzXs","nzValidateStatus"],[1,"ant-input-affix-wrapper-textarea-with-clear-btn",3,"nzSuffix"],["nz-input","","formControlName","notes","placeholder","Notes"],["textAreaClearNotes",""],["nz-row","",1,"register-area"],[3,"nzSpan","nzOffset"],["nz-button","","nzType","primary"],["nz-button","","nzType","default",3,"click"],[3,"ngModel","nzAllowClear","nzDisabled","nzFormat","nzDisabledDate","ngModelChange"],[3,"nzData","nzLoading","nzShowPagination"],["basicTable",""],[4,"ngFor","ngForOf"],[1,"text-right"],[3,"nzPageIndex","nzTotal","nzShowSizeChanger","nzPageSize","nzPageIndexChange","nzPageSizeChange"],[3,"nzLabel","nzValue"],["nz-icon","","class","ant-input-clear-icon","nzTheme","fill","nzType","close-circle",3,"click",4,"ngIf"],["nz-icon","","nzTheme","fill","nzType","close-circle",1,"ant-input-clear-icon",3,"click"],["nz-popconfirm","","nzPopconfirmTitle","Are you sure delete this Collection","nzPopconfirmPlacement","bottom",3,"nzOnConfirm","nzOnCancel",4,"ngIf"],["nz-popconfirm","","nzPopconfirmTitle","Are you sure delete this Collection","nzPopconfirmPlacement","bottom",3,"nzOnConfirm","nzOnCancel"],["nz-icon","","nzType","delete","nzTheme","fill"]],template:function(t,n){if(1&t&&(e.TgZ(0,"div",0)(1,"div",1)(2,"div",2)(3,"h2",3),e._uU(4,"Customer Collections"),e.qZA()()(),e.TgZ(5,"div",1)(6,"div",4)(7,"form",5),e.NdJ("ngSubmit",function(){return n.submitForm()}),e.TgZ(8,"nz-form-item")(9,"nz-form-label",6),e._uU(10,"Date"),e.qZA(),e.TgZ(11,"nz-form-control",7)(12,"nz-date-picker",8),e.NdJ("ngModelChange",function(a){return n.date=a})("ngModelChange",function(a){return n.onChange(a)}),e.qZA()()(),e.TgZ(13,"nz-form-item")(14,"nz-form-label",6)(15,"span"),e._uU(16,"Customer"),e.qZA()(),e.TgZ(17,"nz-form-control",9),e.ALo(18,"number"),e.TgZ(19,"nz-select",10),e.NdJ("ngModelChange",function(a){return n.customerSelected(a)})("ngModelChange",function(a){return n.selectedCustomer=a}),e._UZ(20,"nz-option",11),e.YNc(21,O,1,2,"nz-option",12),e.qZA()()(),e.TgZ(22,"nz-form-item")(23,"nz-form-label",13)(24,"span"),e._uU(25,"Amount"),e.qZA()(),e.TgZ(26,"nz-form-control",14),e._UZ(27,"nz-input-number",15),e.qZA()(),e.TgZ(28,"nz-form-item")(29,"nz-form-label",16),e._uU(30,"Notes"),e.qZA(),e.TgZ(31,"nz-form-control",17)(32,"nz-input-group",18),e._UZ(33,"textarea",19),e.qZA(),e.YNc(34,J,1,1,"ng-template",null,20,e.W1O),e.qZA()(),e.TgZ(36,"nz-form-item",21)(37,"nz-form-control",22)(38,"button",23),e._uU(39,"Create"),e.qZA(),e._uU(40,"\xa0 "),e.TgZ(41,"button",24),e.NdJ("click",function(){return n.reset()}),e._uU(42,"Reset"),e.qZA()()()()(),e.TgZ(43,"div",4)(44,"nz-date-picker",25),e.NdJ("ngModelChange",function(a){return n.collections_date=a})("ngModelChange",function(a){return n.onDateChange(a)}),e.qZA(),e.TgZ(45,"nz-table",26,27)(47,"thead")(48,"tr")(49,"th"),e._uU(50,"S.No."),e.qZA(),e.TgZ(51,"th"),e._uU(52,"Date"),e.qZA(),e.TgZ(53,"th"),e._uU(54,"Customer Name"),e.qZA(),e.TgZ(55,"th"),e._uU(56,"Amount"),e.qZA(),e.TgZ(57,"th"),e._uU(58,"Notes"),e.qZA(),e.TgZ(59,"th"),e._uU(60,"Actions"),e.qZA()()(),e.TgZ(61,"tbody"),e.YNc(62,P,14,9,"tr",28),e.qZA()(),e.TgZ(63,"div",29),e._UZ(64,"br"),e.TgZ(65,"nz-pagination",30),e.NdJ("nzPageIndexChange",function(a){return n.onPageChange(a)})("nzPageSizeChange",function(a){return n.onPageSizeChange(a)}),e.qZA(),e._UZ(66,"br"),e.qZA()()()()),2&t){const o=e.MAs(35);e.xp6(7),e.Q6J("formGroup",n.validateForm),e.xp6(2),e.Q6J("nzSm",6)("nzXs",24),e.xp6(2),e.Q6J("nzSm",14)("nzXs",24),e.xp6(1),e.Q6J("ngModel",n.date)("nzAllowClear",!1)("nzFormat",n.dateFormat)("nzDisabled",n.dateDisable),e.xp6(2),e.Q6J("nzSm",6)("nzXs",24),e.xp6(3),e.s9C("nzExtra",n.selectedCustomer?"Balance amount: "+e.xi3(18,43,(null==n.selectedCustomer?null:n.selectedCustomer.balance_amount)+(null==n.selectedCustomer?null:n.selectedCustomer.last_amount_updated),"1.2-2"):""),e.Q6J("nzSm",14)("nzXs",24),e.xp6(2),e.Q6J("ngModel",n.selectedCustomer),e.xp6(2),e.Q6J("ngForOf",n.customers),e.xp6(2),e.Q6J("nzSm",6)("nzXs",24),e.xp6(3),e.Q6J("nzSm",14)("nzXs",24),e.xp6(1),e.Q6J("nzMin",1)("nzStep",1),e.xp6(2),e.Q6J("nzSm",6)("nzXs",24),e.xp6(2),e.Q6J("nzSm",14)("nzXs",24)("nzValidateStatus",n.validateForm.controls.notes),e.xp6(1),e.Q6J("nzSuffix",o),e.xp6(5),e.Q6J("nzSpan",14)("nzOffset",6),e.xp6(7),e.Q6J("ngModel",n.collections_date)("nzAllowClear",!1)("nzDisabled",n.dateDisable)("nzFormat",n.dateFormat)("nzDisabledDate",n.disabledFDate),e.xp6(1),e.Q6J("nzData",n.collectionsData)("nzLoading",n.loading)("nzShowPagination",!1),e.xp6(17),e.Q6J("ngForOf",n.collectionsData),e.xp6(3),e.Q6J("nzPageIndex",n.index)("nzTotal",n.total)("nzShowSizeChanger",!0)("nzPageSize",n.pageSize)}},dependencies:[c.sg,c.O5,S.Ls,p.t3,p.SK,u.Lr,u.Nx,u.iK,u.Fd,r._Y,r.Fj,r.JJ,r.JL,r.On,r.sg,r.u,g.Zp,g.gB,g.ke,h.Ip,h.Vq,Z.ix,T.w,A.dQ,b._V,M.uw,m.N8,m.Uo,m._C,m.Om,m.p0,m.$Z,x.JW,F.dE,c.JJ],styles:["[nz-form][_ngcontent-%COMP%]{max-width:600px}.phone-select[_ngcontent-%COMP%]{width:70px}.register-are[_ngcontent-%COMP%]{margin-bottom:8px}.customer-form[_ngcontent-%COMP%]{margin-top:20px}nz-date-picker[_ngcontent-%COMP%]{margin:0 8px 12px 0}input[type=number][_ngcontent-%COMP%]{border:1px solid #d9d9d9!important}input[type=number][_ngcontent-%COMP%]:focus{border:1px solid #40a9ff!important}.text-center[_ngcontent-%COMP%]{text-align:center!important}.text-right[_ngcontent-%COMP%]{text-align:right!important}  .ant-select-item-option-selected:not(.ant-select-item-option-disabled){background-color:green;color:#fff}  .ant-select-item-option-active:not(.ant-select-item-option-disabled){background-color:green;color:#fff}"]}),i})()}];let N=(()=>{class i{}return i.\u0275fac=function(t){return new(t||i)},i.\u0275mod=e.oAB({type:i}),i.\u0275inj=e.cJS({imports:[d.Bz.forChild(U),d.Bz]}),i})();var q=s(4973);let I=(()=>{class i{}return i.\u0275fac=function(t){return new(t||i)},i.\u0275mod=e.oAB({type:i}),i.\u0275inj=e.cJS({imports:[c.ez,N,q.m]}),i})()}}]);