"use strict";(self.webpackChunktraders=self.webpackChunktraders||[]).push([[380],{67928:(L,f,a)=>{a.r(f),a.d(f,{ReportCollectionsModule:()=>X});var u=a(36895),z=a(4973),g=a(64575),i=a(90433),m=a(15439),e=a(94650),Z=a(49651),A=a(32566),v=a(30901),T=a(31883),x=a(21102),C=a(73679),p=a(36704),_=a(35635),U=a(66616),y=a(47044),q=a(21811),b=a(37096),S=a(5259),c=a(44688),F=a(6497);function O(s,r){if(1&s){const t=e.EpF();e.TgZ(0,"span",24),e.NdJ("click",function(){e.CHM(t);const n=e.oxw(2);return e.KtG(n.clearfield("notes"))}),e.qZA()}}function N(s,r){if(1&s&&e.YNc(0,O,1,0,"span",23),2&s){const t=e.oxw();e.Q6J("ngIf",t.validateForm.controls.notes.value)}}function R(s,r){if(1&s){const t=e.EpF();e.TgZ(0,"a",30),e.NdJ("nzOnConfirm",function(){e.CHM(t);const n=e.oxw().$implicit,l=e.oxw(2);return e.KtG(l.approveReport(n))})("nzOnCancel",function(){e.CHM(t);const n=e.oxw(3);return e.KtG(n.cancel())}),e._uU(1," Approve "),e.qZA()}}function J(s,r){1&s&&(e.TgZ(0,"span",31),e._uU(1," Approved "),e.qZA())}function Y(s,r){if(1&s&&(e.TgZ(0,"tr")(1,"td"),e._uU(2),e.qZA(),e.TgZ(3,"td"),e._uU(4),e.qZA(),e.TgZ(5,"td"),e._uU(6),e.qZA(),e.TgZ(7,"td"),e._uU(8),e.qZA(),e.TgZ(9,"td"),e._uU(10),e.qZA(),e.TgZ(11,"td"),e._uU(12),e.qZA(),e.TgZ(13,"td"),e._uU(14),e.qZA(),e.TgZ(15,"td"),e.YNc(16,R,2,0,"a",28),e.YNc(17,J,2,0,"span",29),e._uU(18,"\xa0\xa0 "),e.qZA()()),2&s){const t=r.$implicit,o=r.index;e.xp6(2),e.Oqu(o+1),e.xp6(2),e.Oqu(t.created_name),e.xp6(2),e.Oqu(t.amount),e.xp6(2),e.Oqu(t.date),e.xp6(2),e.Oqu(t.reason_type),e.xp6(2),e.Oqu(t.spent_amount),e.xp6(2),e.Oqu(t.notes),e.xp6(2),e.Q6J("ngIf",!t.report_approved),e.xp6(1),e.Q6J("ngIf",t.report_approved)}}function M(s,r){if(1&s&&(e.TgZ(0,"nz-table",25,26)(2,"thead")(3,"tr")(4,"th"),e._uU(5,"S.No."),e.qZA(),e.TgZ(6,"th"),e._uU(7,"Name"),e.qZA(),e.TgZ(8,"th"),e._uU(9,"Amount"),e.qZA(),e.TgZ(10,"th"),e._uU(11,"Date"),e.qZA(),e.TgZ(12,"th"),e._uU(13,"Spent Reason"),e.qZA(),e.TgZ(14,"th"),e._uU(15,"Spent Amount"),e.qZA(),e.TgZ(16,"th"),e._uU(17,"Notes"),e.qZA(),e.TgZ(18,"th"),e._uU(19,"Status"),e.qZA()()(),e.TgZ(20,"tbody"),e.YNc(21,Y,19,9,"tr",27),e.qZA()()),2&s){const t=e.oxw();e.Q6J("nzData",t.collectionsData)("nzLoading",t.loading),e.xp6(21),e.Q6J("ngForOf",t.collectionsData)}}function D(s,r){if(1&s&&(e.TgZ(0,"tr")(1,"td"),e._uU(2),e.qZA(),e.TgZ(3,"td"),e._uU(4),e.qZA(),e.TgZ(5,"td"),e._uU(6),e.ALo(7,"number"),e.qZA(),e.TgZ(8,"td"),e._uU(9),e.qZA(),e.TgZ(10,"td"),e._uU(11),e.qZA()()),2&s){const t=r.$implicit,o=r.index;e.xp6(2),e.Oqu(o+1),e.xp6(2),e.Oqu(t.customer_name),e.xp6(2),e.Oqu(e.xi3(7,5,t.amount,"1.2-2")),e.xp6(3),e.Oqu(t.collected_name),e.xp6(2),e.Oqu(t.notes)}}function B(s,r){if(1&s&&(e.TgZ(0,"div",32)(1,"h3"),e._uU(2,"Today Collections"),e.qZA(),e.TgZ(3,"nz-table",33,34)(5,"thead")(6,"tr")(7,"th"),e._uU(8,"S.No."),e.qZA(),e.TgZ(9,"th"),e._uU(10,"Customer Name"),e.qZA(),e.TgZ(11,"th"),e._uU(12,"Amount"),e.qZA(),e.TgZ(13,"th"),e._uU(14,"Collected Name"),e.qZA(),e.TgZ(15,"th"),e._uU(16,"Notes"),e.qZA()()(),e.TgZ(17,"tbody"),e.YNc(18,D,12,8,"tr",27),e.TgZ(19,"tr"),e._UZ(20,"td")(21,"td"),e.TgZ(22,"td"),e._uU(23),e.ALo(24,"number"),e.qZA(),e._UZ(25,"td")(26,"td"),e.qZA()()()()),2&s){const t=e.oxw();e.xp6(3),e.Q6J("nzData",t.collectionsByUser),e.xp6(15),e.Q6J("ngForOf",t.collectionsByUser),e.xp6(5),e.Oqu(e.xi3(24,3,t.user_collected_total_amount,"1.2-2"))}}function Q(s,r){if(1&s&&(e.TgZ(0,"tr")(1,"td"),e._uU(2),e.qZA(),e.TgZ(3,"td"),e._uU(4),e.qZA(),e.TgZ(5,"td"),e._uU(6),e.qZA(),e.TgZ(7,"td"),e._uU(8),e.ALo(9,"number"),e.qZA()()),2&s){const t=r.$implicit,o=r.index;e.xp6(2),e.Oqu(o+1),e.xp6(2),e.Oqu(t.collection_date),e.xp6(2),e.Oqu(t.customer_name),e.xp6(2),e.Oqu(e.xi3(9,4,t.amount,"1.2-2"))}}function I(s,r){if(1&s){const t=e.EpF();e.ynx(0),e.TgZ(1,"tr")(2,"td",37),e.NdJ("nzExpandChange",function(n){const d=e.CHM(t).$implicit,h=e.oxw(2);return e.KtG(h.onExpandChange(d.collected_user_id,n))}),e.qZA(),e.TgZ(3,"td"),e._uU(4),e.qZA(),e.TgZ(5,"td"),e._uU(6),e.qZA(),e.TgZ(7,"td"),e._uU(8),e.ALo(9,"number"),e.qZA()(),e.TgZ(10,"tr",38)(11,"nz-table",33,39)(13,"thead")(14,"tr")(15,"th"),e._uU(16,"S.No."),e.qZA(),e.TgZ(17,"th"),e._uU(18,"Date"),e.qZA(),e.TgZ(19,"th"),e._uU(20,"Customer Name"),e.qZA(),e.TgZ(21,"th"),e._uU(22,"Amount"),e.qZA()(),e.YNc(23,Q,10,7,"tr",27),e.qZA()()(),e.BQk()}if(2&s){const t=r.$implicit,o=r.index,n=e.oxw(2);e.xp6(2),e.Q6J("nzExpand",n.expandSet.has(t.collected_user_id)),e.xp6(2),e.Oqu(o+1),e.xp6(2),e.Oqu(t.collected_user_name),e.xp6(2),e.Oqu(e.xi3(9,7,t.collectedAmount,"1.2-2")),e.xp6(2),e.Q6J("nzExpand",n.expandSet.has(t.collected_user_id)),e.xp6(1),e.Q6J("nzData",t.collections),e.xp6(12),e.Q6J("ngForOf",t.collections)}}function E(s,r){if(1&s&&(e.TgZ(0,"div",32)(1,"h3"),e._uU(2,"Today All Collections"),e.qZA(),e.TgZ(3,"nz-table",33,35)(5,"thead")(6,"tr"),e._UZ(7,"th",36),e.TgZ(8,"th"),e._uU(9,"S.No."),e.qZA(),e.TgZ(10,"th"),e._uU(11,"User"),e.qZA(),e.TgZ(12,"th"),e._uU(13,"Collected Amount"),e.qZA()()(),e.TgZ(14,"tbody"),e.YNc(15,I,24,10,"ng-container",27),e.qZA()()()),2&s){const t=e.oxw();e.xp6(3),e.Q6J("nzData",t.CollectionsAllUser),e.xp6(12),e.Q6J("ngForOf",t.CollectionsAllUser)}}const P=[{path:"",component:(()=>{class s{constructor(t,o,n,l,d,h){this.fb=t,this.message=o,this.mainService=n,this.exportAsService=l,this.router=d,this.farmerService=h,this.collectionsData=[],this.sort=["ascend"],this.listOfColumns=[{name:"Name"},{phoneNumber:"Phone Number"},{address:"Address"},{notes:"Note"}],this.index=1,this.total=0,this.pageSize=10,this.loading=!1,this.edit=!1,this.downloadAs="pdf",this.exportAsConfig={type:"pdf",elementIdOrContent:"sampleTable"},this.customers=[],this.reasonTypes=["Petrol","Farmer","Transport","Cooli"],this.totalCollectedAmount=0,this.date=new Date,this.dateDisable=!1,this.dateFormat="dd-MM-yyyy",this.collectionsByUser=[],this.user_collected_total_amount=0,this.CollectionsAllUser=[],this.expandSet=new Set,this.userinfo=this.mainService.getLoggedInUser(),this.validateForm=this.fb.group({amount:[null,[i.kI.required]],notes:[null],date:[this.date,[i.kI.required]],reasonType:this.fb.array([this.addReasonTpes()])}),"admin"!==this.userinfo.username&&(this.dateDisable=!1)}get reasonType(){return this.validateForm.get("reasonType")}addReasonTpes(){return this.fb.group({reason_type:new i.NI(""),reason_amount:new i.NI("")})}addfield(){this.reasonType.push(this.addReasonTpes())}removeField(t){this.reasonType.length>1&&this.reasonType.removeAt(t)}ngOnInit(){this.getAllFarmers();const t=new Date;this.getcollection_reports(),"admin"!==this.userinfo.username?this.getCollectionsByUser(m(t).format("DD-MM-YYYY")):this.getCollectionsAllUser(m(t).format("DD-MM-YYYY"))}submitForm(){console.log("this.validateForm.value: ",this.validateForm.value);const t={date:m(this.validateForm.value.date).format("DD-MM-YYYY"),reason_type:this.validateForm.value.reason_type,farmer_id:"Farmer"===this.validateForm.value.reason_type?this.validateForm.value.farmer._id:"",amount:this.validateForm.value.amount,spent_amount:this.validateForm.value.reason_amount,notes:this.validateForm.value.notes};console.log("requestBody: ",t)}clearfield(t){this.validateForm.controls[t].reset()}reset(){this.validateForm.controls.amount.reset(),this.validateForm.controls.notes.reset()}exportToExcel(){let t=[];this.collectionsData.forEach(n=>{t.push({Name:n.name,"Phone Number":n.phone_number,Address:n.address,Notes:n.notes})}),this.exportAsConfig.type=this.downloadAs,this.exportAsConfig.elementIdOrContent="<table><thead><tr><th>Name</th><th>Balance Amount</th><th>Paid Amount</th></tr></thead><tbody><tr><td>Rajesh</td><td>1500</td><td>500</td></tr><tr><td>Customer1</td><td>0</td><td>0</td></tr></tbody></table>",this.exportAsConfig.options={margins:{top:"50"}},this.exportAsService.save(this.exportAsConfig,"customers").subscribe(()=>{})}editCustomer(t){this.edit=!0,this.customerId=t._id,this.validateForm.controls.phoneNumber.setValue(t.phone_number),this.validateForm.controls.name.setValue(t.name),this.validateForm.controls.notes.setValue(t.notes),this.validateForm.controls.address.setValue(t.address)}deleteConfirm(t){this.mainService.removeCustomer(t).subscribe(o=>{this.loading=!1,o&&o.success?this.message.create("success",o.message):o.success||this.message.create("warning",o.message)},o=>{console.log("get customers err ",o),this.loading=!1,o&&o.error&&!o.error.success&&1e3===o.error.code&&(this.message.create("error",o.error.message),sessionStorage.clear(),this.router.navigateByUrl("/login"))})}cancel(){}onPageSizeChange(t){this.pageSize=t}onPageChange(t){this.index=t}getAllFarmers(){document.getElementById("farmerName")?.focus(),this.farmerService.getFarmers({}).subscribe(o=>{this.farmersData=o.data,this.total=o.total},o=>{console.log("get farmers err ",o),this.farmersData=[],o&&o.error&&!o.error.success&&1e3===o.error.code&&(this.message.create("error",o.error.message),sessionStorage.clear(),this.router.navigateByUrl("/login"))})}getcollection_reports(){let t={};const o=new Date;"admin"===this.userinfo.username?t.date=m(o).format("DD-MM-YYYY"):(t.date=m(o).format("DD-MM-YYYY"),t.username=this.userinfo.username),this.mainService.getcollection_reports(t).subscribe(n=>{console.log("data: ",n),this.collectionsData=n},n=>{console.log("get collection_reports err ",n),n&&n.error&&!n.error.success&&1e3===n.error.code&&(this.message.create("error",n.error.message),sessionStorage.clear(),this.router.navigateByUrl("/login"))})}getCollectionAmountByUser(t){this.mainService.getCollectionAmountByUser({collection_date:t}).subscribe(o=>{this.totalCollectedAmount=o.collectedAmount,m(new Date).format("DD-MM-YYYY");const d=this.validateForm.value.amount+(this.validateForm.value.reason_amount||0);console.log("useramount: ",d),console.log("this.totalCollectedAmount: ",this.totalCollectedAmount),this.totalCollectedAmount===d?this.message.create("info","okay"):this.message.create("error","not okay")},o=>{console.log("getCollectionAmountByUser err ",o),o&&o.error&&!o.error.success&&1e3===o.error.code&&(this.message.create("error",o.error.message),sessionStorage.clear(),this.router.navigateByUrl("/login"))})}onChange(t){}getCollectionsByUser(t){let o={user_id:this.userinfo.userId,collection_date:t};console.log("request_body: ",o),this.mainService.getCollectionsByUser(o).subscribe(n=>{n&&n.length>0&&(this.collectionsByUser=n,this.collectionsByUser.forEach(l=>{this.user_collected_total_amount=this.user_collected_total_amount+l.amount}),console.log("this.collectionsByUser: ",this.collectionsByUser))},n=>{console.log("get Collections By User err ",n),n&&n.error&&!n.error.success&&1e3===n.error.code&&(this.message.create("error",n.error.message),sessionStorage.clear(),this.router.navigateByUrl("/login"))})}getCollectionsAllUser(t){let o={collection_date:t};console.log("request_body: ",o),this.mainService.getCollectionsByUser(o).subscribe(n=>{n&&n.length>0&&(this.CollectionsAllUser=n)},n=>{console.log("get Collections By User err ",n),n&&n.error&&!n.error.success&&1e3===n.error.code&&(this.message.create("error",n.error.message),sessionStorage.clear(),this.router.navigateByUrl("/login"))})}onExpandChange(t,o){o?this.expandSet.add(t):this.expandSet.delete(t)}approveReport(t){console.log("data: ",t)}}return s.\u0275fac=function(t){return new(t||s)(e.Y36(i.QS),e.Y36(Z.dD),e.Y36(A.J),e.Y36(v.f),e.Y36(g.F0),e.Y36(T.y))},s.\u0275cmp=e.Xpm({type:s,selectors:[["app-report-collections"]],decls:40,vars:28,consts:[[1,"customer-form"],["nz-row",""],["nz-col","","nzSpan","24"],[1,"text-center"],["nz-col","","nzSpan","12"],["nz-form","",3,"formGroup"],[3,"nzSm","nzXs"],["formControlName","date",3,"ngModel","nzAllowClear","nzDisabled","nzFormat","ngModelChange"],["nzFor","amount","nzRequired","",3,"nzSm","nzXs"],["nzErrorTip","Enter Amount",3,"nzSm","nzXs"],["type","number","id","amount","formControlName","amount",3,"nzMin","nzStep"],["nz-button","","nzType","primary",3,"click"],["nzFor","notes",3,"nzSm","nzXs"],["nzErrorTip","Please input your notes!",3,"nzSm","nzXs","nzValidateStatus"],[1,"ant-input-affix-wrapper-textarea-with-clear-btn",3,"nzSuffix"],["nz-input","","formControlName","notes","placeholder","Notes"],["textAreaClearNotes",""],["nz-row","",1,"register-area"],[3,"nzSpan","nzOffset"],["nz-button","","nzType","primary",3,"disabled","click"],["nz-button","","nzType","default",3,"click"],[3,"nzData","nzLoading",4,"ngIf"],["class","margin-top-15",4,"ngIf"],["nz-icon","","class","ant-input-clear-icon","nzTheme","fill","nzType","close-circle",3,"click",4,"ngIf"],["nz-icon","","nzTheme","fill","nzType","close-circle",1,"ant-input-clear-icon",3,"click"],[3,"nzData","nzLoading"],["customerTable",""],[4,"ngFor","ngForOf"],["nz-popconfirm","","nzPopconfirmTitle","Are you sure for approve report","nzPopconfirmPlacement","left",3,"nzOnConfirm","nzOnCancel",4,"ngIf"],["style","color: green;",4,"ngIf"],["nz-popconfirm","","nzPopconfirmTitle","Are you sure for approve report","nzPopconfirmPlacement","left",3,"nzOnConfirm","nzOnCancel"],[2,"color","green"],[1,"margin-top-15"],[3,"nzData"],["collectionsByUs",""],["CollectionsAllUse",""],["nzWidth","60px"],[3,"nzExpand","nzExpandChange"],[3,"nzExpand"],["usercollections",""]],template:function(t,o){if(1&t&&(e.TgZ(0,"div",0)(1,"div",1)(2,"div",2)(3,"h2",3),e._uU(4,"Collection Report"),e.qZA()()(),e.TgZ(5,"div",1)(6,"div",4)(7,"form",5)(8,"nz-form-item")(9,"nz-form-label",6),e._uU(10,"Date"),e.qZA(),e.TgZ(11,"nz-form-control",6)(12,"nz-date-picker",7),e.NdJ("ngModelChange",function(l){return o.date=l})("ngModelChange",function(l){return o.onChange(l)}),e.qZA()()(),e.TgZ(13,"nz-form-item")(14,"nz-form-label",8)(15,"span"),e._uU(16,"Amount"),e.qZA()(),e.TgZ(17,"nz-form-control",9),e._UZ(18,"nz-input-number",10),e.qZA()(),e.TgZ(19,"button",11),e.NdJ("click",function(){return o.addfield()}),e._uU(20,"Add"),e.qZA(),e.TgZ(21,"nz-form-item")(22,"nz-form-label",12),e._uU(23,"Notes"),e.qZA(),e.TgZ(24,"nz-form-control",13)(25,"nz-input-group",14),e._UZ(26,"textarea",15),e.qZA(),e.YNc(27,N,1,1,"ng-template",null,16,e.W1O),e.qZA()(),e.TgZ(29,"nz-form-item",17)(30,"nz-form-control",18)(31,"button",19),e.NdJ("click",function(){return o.submitForm()}),e._uU(32),e.qZA(),e._uU(33,"\xa0 "),e.TgZ(34,"button",20),e.NdJ("click",function(){return o.reset()}),e._uU(35,"Reset"),e.qZA()()()()(),e.TgZ(36,"div",4),e.YNc(37,M,22,3,"nz-table",21),e.YNc(38,B,27,6,"div",22),e.YNc(39,E,16,2,"div",22),e.qZA()()()),2&t){const n=e.MAs(28);e.xp6(7),e.Q6J("formGroup",o.validateForm),e.xp6(2),e.Q6J("nzSm",6)("nzXs",24),e.xp6(2),e.Q6J("nzSm",14)("nzXs",24),e.xp6(1),e.Q6J("ngModel",o.date)("nzAllowClear",!1)("nzDisabled",o.dateDisable)("nzFormat",o.dateFormat),e.xp6(2),e.Q6J("nzSm",6)("nzXs",24),e.xp6(3),e.Q6J("nzSm",14)("nzXs",24),e.xp6(1),e.Q6J("nzMin",0)("nzStep",1),e.xp6(4),e.Q6J("nzSm",6)("nzXs",24),e.xp6(2),e.Q6J("nzSm",14)("nzXs",24)("nzValidateStatus",o.validateForm.controls.notes),e.xp6(1),e.Q6J("nzSuffix",n),e.xp6(5),e.Q6J("nzSpan",14)("nzOffset",6),e.xp6(1),e.Q6J("disabled",!o.validateForm.valid),e.xp6(1),e.Oqu(o.edit?"Update":"Submit"),e.xp6(5),e.Q6J("ngIf",o.collectionsData&&o.collectionsData.length>0),e.xp6(1),e.Q6J("ngIf",o.collectionsByUser&&o.collectionsByUser.length>0),e.xp6(1),e.Q6J("ngIf",o.CollectionsAllUser&&o.CollectionsAllUser.length>0)}},dependencies:[u.sg,u.O5,x.Ls,C.t3,C.SK,p.Lr,p.Nx,p.iK,p.Fd,i._Y,i.Fj,i.JJ,i.JL,i.sg,i.u,_.Zp,_.gB,_.ke,U.ix,y.w,q.dQ,b._V,S.uw,c.N8,c.Uo,c._C,c.h7,c.Om,c.p0,c.$Z,c.d3,c.Vk,F.JW,u.JJ],styles:["[nz-form][_ngcontent-%COMP%]{max-width:600px}.phone-select[_ngcontent-%COMP%]{width:70px}.register-are[_ngcontent-%COMP%]{margin-bottom:8px}.customer-form[_ngcontent-%COMP%]{margin-top:20px}.text-center[_ngcontent-%COMP%]{text-align:center!important}.text-right[_ngcontent-%COMP%]{text-align:right!important}.reason_type_custom[_ngcontent-%COMP%]{width:100%;margin-left:10%}"]}),s})()}];let w=(()=>{class s{}return s.\u0275fac=function(t){return new(t||s)},s.\u0275mod=e.oAB({type:s}),s.\u0275inj=e.cJS({imports:[g.Bz.forChild(P),g.Bz]}),s})(),X=(()=>{class s{}return s.\u0275fac=function(t){return new(t||s)},s.\u0275mod=e.oAB({type:s}),s.\u0275inj=e.cJS({imports:[u.ez,w,z.m]}),s})()}}]);