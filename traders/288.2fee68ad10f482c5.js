(self.webpackChunktraders=self.webpackChunktraders||[]).push([[288],{88288:(U,Z,o)=>{"use strict";o.r(Z),o.d(Z,{CustomerModule:()=>K});var x=o(36895),g=o(64575),p=o(90433),z=o(94327),C=o(80574),e=o(94650),f=o(49651),y=o(32566),S=o(30901),r=o(37570),a=o(21102),u=o(73679),l=o(36704),c=o(35635),F=o(38231),N=o(66616),T=o(47044),E=o(21811),h=o(44688),v=o(6497),P=o(21634);function O(s,d){1&s&&(e.TgZ(0,"nz-select",33),e._UZ(1,"nz-option",34),e.qZA())}function M(s,d){if(1&s){const n=e.EpF();e.TgZ(0,"span",36),e.NdJ("click",function(){e.CHM(n);const i=e.oxw(3);return e.KtG(i.clearfield("address"))}),e.qZA()}}function J(s,d){if(1&s&&e.YNc(0,M,1,0,"span",35),2&s){const n=e.oxw(2);e.Q6J("ngIf",n.validateForm.controls.address.value)}}function B(s,d){if(1&s){const n=e.EpF();e.TgZ(0,"span",36),e.NdJ("click",function(){e.CHM(n);const i=e.oxw(3);return e.KtG(i.clearfield("notes"))}),e.qZA()}}function R(s,d){if(1&s&&e.YNc(0,B,1,0,"span",35),2&s){const n=e.oxw(2);e.Q6J("ngIf",n.validateForm.controls.notes.value)}}function L(s,d){if(1&s){const n=e.EpF();e.TgZ(0,"form",11),e.NdJ("ngSubmit",function(){e.CHM(n);const i=e.oxw();return e.KtG(i.submitForm())}),e.TgZ(1,"nz-form-item")(2,"nz-form-label",12)(3,"span"),e._uU(4,"Name"),e.qZA()(),e.TgZ(5,"nz-form-control",13),e._UZ(6,"input",14),e.qZA()(),e.TgZ(7,"nz-form-item")(8,"nz-form-label",15),e._uU(9,"Phone Number"),e.qZA(),e.TgZ(10,"nz-form-control",16)(11,"nz-input-group",17),e.YNc(12,O,2,0,"ng-template",null,18,e.W1O),e._UZ(14,"input",19),e.qZA()()(),e.TgZ(15,"nz-form-item")(16,"nz-form-label",20),e._uU(17,"Address"),e.qZA(),e.TgZ(18,"nz-form-control",21)(19,"nz-input-group",22),e._UZ(20,"textarea",23),e.qZA(),e.YNc(21,J,1,1,"ng-template",null,24,e.W1O),e.qZA()(),e.TgZ(23,"nz-form-item")(24,"nz-form-label",25),e._uU(25,"Notes"),e.qZA(),e.TgZ(26,"nz-form-control",26)(27,"nz-input-group",22),e._UZ(28,"textarea",27),e.qZA(),e.YNc(29,R,1,1,"ng-template",null,28,e.W1O),e.qZA()(),e.TgZ(31,"nz-form-item",29)(32,"nz-form-control",30)(33,"button",31),e._uU(34),e.qZA(),e._uU(35,"\xa0 "),e.TgZ(36,"button",32),e.NdJ("click",function(){e.CHM(n);const i=e.oxw();return e.KtG(i.reset())}),e._uU(37,"Reset"),e.qZA()()()()}if(2&s){const n=e.MAs(13),t=e.MAs(22),i=e.MAs(30),m=e.oxw();e.Q6J("formGroup",m.validateForm),e.xp6(2),e.Q6J("nzSm",6)("nzXs",24),e.xp6(3),e.Q6J("nzSm",14)("nzXs",24),e.xp6(3),e.Q6J("nzSm",6)("nzXs",24),e.xp6(2),e.Q6J("nzSm",14)("nzXs",24)("nzValidateStatus",m.validateForm.controls.phoneNumber),e.xp6(1),e.Q6J("nzAddOnBefore",n),e.xp6(3),e.Q6J("maxlength",10),e.xp6(2),e.Q6J("nzSm",6)("nzXs",24),e.xp6(2),e.Q6J("nzSm",14)("nzXs",24)("nzValidateStatus",m.validateForm.controls.address),e.xp6(1),e.Q6J("nzSuffix",t),e.xp6(5),e.Q6J("nzSm",6)("nzXs",24),e.xp6(2),e.Q6J("nzSm",14)("nzXs",24)("nzValidateStatus",m.validateForm.controls.notes),e.xp6(1),e.Q6J("nzSuffix",i),e.xp6(5),e.Q6J("nzSpan",14)("nzOffset",6),e.xp6(1),e.Q6J("disabled",!m.validateForm.valid),e.xp6(1),e.Oqu(m.edit?"Update":"Create")}}function I(s,d){if(1&s){const n=e.EpF();e.TgZ(0,"a",42),e.NdJ("click",function(){e.CHM(n);const i=e.oxw().$implicit,m=e.oxw(2);return e.KtG(m.editCustomer(i))}),e._UZ(1,"span",43),e.qZA()}}function Q(s,d){if(1&s){const n=e.EpF();e.TgZ(0,"a",44),e.NdJ("nzOnConfirm",function(){e.CHM(n);const i=e.oxw().$implicit,m=e.oxw(2);return e.KtG(m.deleteConfirm(i._id))})("nzOnCancel",function(){e.CHM(n);const i=e.oxw(3);return e.KtG(i.cancel())}),e._UZ(1,"span",45),e.qZA()}}function D(s,d){if(1&s&&(e.TgZ(0,"tr")(1,"td"),e._uU(2),e.qZA(),e.TgZ(3,"td"),e._uU(4),e.qZA(),e.TgZ(5,"td"),e._uU(6),e.qZA(),e.TgZ(7,"td"),e._uU(8),e.qZA(),e.TgZ(9,"td"),e.YNc(10,I,2,0,"a",40),e._uU(11,"\xa0\xa0 "),e.YNc(12,Q,2,0,"a",41),e.qZA()()),2&s){const n=d.$implicit,t=e.oxw(2);e.xp6(2),e.Oqu(n.name),e.xp6(2),e.Oqu(n.phone_number),e.xp6(2),e.Oqu(n.address),e.xp6(2),e.Oqu(n.notes),e.xp6(2),e.Q6J("ngIf","admin"===t.userinfo.username||t.userinfo.apps.customer&&t.userinfo.apps.customer.isEdit),e.xp6(2),e.Q6J("ngIf","admin"===t.userinfo.username||t.userinfo.apps.customer&&t.userinfo.apps.customer.isEdit)}}function w(s,d){if(1&s&&(e.TgZ(0,"nz-table",37,38)(2,"thead")(3,"tr")(4,"th"),e._uU(5,"Name"),e.qZA(),e.TgZ(6,"th"),e._uU(7,"Phone Number"),e.qZA(),e.TgZ(8,"th"),e._uU(9,"Address"),e.qZA(),e.TgZ(10,"th"),e._uU(11,"Notes"),e.qZA(),e.TgZ(12,"th"),e._uU(13,"Actions"),e.qZA()()(),e.TgZ(14,"tbody"),e.YNc(15,D,13,6,"tr",39),e.qZA()()),2&s){const n=e.oxw();e.Q6J("nzData",n.customersData)("nzLoading",n.loading)("nzShowPagination",!1),e.xp6(15),e.Q6J("ngForOf",n.customersData)}}const Y=[{path:"customer",component:(()=>{class s{constructor(n,t,i,m,A){this.fb=n,this.message=t,this.mainService=i,this.exportAsService=m,this.router=A,this.customersData=[],this.sort=["ascend"],this.listOfColumns=[{name:"Name"},{phoneNumber:"Phone Number"},{address:"Address"},{notes:"Note"}],this.index=1,this.total=0,this.pageSize=10,this.loading=!0,this.edit=!1,this.downloadAs="pdf",this.exportAsConfig={type:"pdf",elementIdOrContent:"sampleTable"},this.userinfo=this.mainService.getLoggedInUser(),console.log("this.userinfo: ",this.userinfo),this.userinfo?"admin"!==this.userinfo.username&&((this.userinfo.apps.customer.isEdit||this.userinfo.apps.customer.isView)&&this.userinfo.apps.customer.isView||this.router.navigateByUrl("/main")):(sessionStorage.clear(),this.message.create("warning","User session expired please login"),this.router.navigateByUrl("/login"))}ngOnInit(){this.validateForm=this.fb.group({name:[null,[p.kI.required]],phoneNumberPrefix:["+91"],phoneNumber:[null],address:[null],notes:[null]}),this.getCustomers()}getCustomers(){const n={skip:this.index,limit:this.pageSize};document.getElementById("customerName")?.focus(),this.mainService.spinning.emit(!0),this.mainService.getCustomers(n).subscribe(t=>{const i=t.data;this.mainService.spinning.emit(!1),this.customersData=i,this.total=t.total,this.loading=!1},t=>{console.log("get customers err ",t),this.mainService.spinning.emit(!1),this.customersData=[],this.loading=!1,t&&t.error&&!t.error.success&&1e3===t.error.code&&(this.message.create("error",t.error.message),sessionStorage.clear(),this.router.navigateByUrl("/login"))})}clearfield(n){this.validateForm.controls[n].reset()}submitForm(){if(this.validateForm.valid){const n={name:this.validateForm.value.name,phone_number:this.validateForm.value.phoneNumber,address:this.validateForm.value.address,notes:this.validateForm.value.notes};this.mainService.spinning.emit(!0),this.edit?this.mainService.updateCustomer(this.customerId,n).subscribe(t=>{this.message.create("success",`${this.validateForm.value.name} customer updated Successfully`),this.reset(),this.loading=!0,this.edit=!1,this.mainService.spinning.emit(!1),this.getCustomers()},t=>{console.log("get customers err ",t),this.loading=!1,this.mainService.spinning.emit(!1),t&&t.error?!t.error.success&&1e3===t.error.code&&(this.message.create("error",t.error.message),sessionStorage.clear(),this.router.navigateByUrl("/login")):this.getCustomers()}):this.mainService.createCustomer(n).subscribe(t=>{this.message.create("success",`${this.validateForm.value.name} Customer added Successfully`),this.reset(),this.loading=!0,this.mainService.spinning.emit(!1),this.getCustomers()},t=>{console.log("get customers err ",t),this.loading=!1,this.mainService.spinning.emit(!1),t&&t.error?!t.error.success&&1e3===t.error.code&&(this.message.create("error",t.error.message),sessionStorage.clear(),this.router.navigateByUrl("/login")):this.getCustomers()})}else this.mainService.spinning.emit(!1),Object.values(this.validateForm.controls).forEach(n=>{n.invalid&&(n.markAsDirty(),n.updateValueAndValidity({onlySelf:!0}))})}exportJsonAsExcelFile(n,t){const m={Sheets:{data:C.P6.json_to_sheet(n)},SheetNames:["data"]},A=C.cW(m,{bookType:"xlsx",type:"array"});this.saveAsExcelFile(A,t)}exportTableAsExcelFile(n,t){const m={Sheets:{data:C.P6.table_to_sheet(n)},SheetNames:["data"]},A=C.cW(m,{bookType:"xlsx",type:"array"});this.saveAsExcelFile(A,t)}saveAsExcelFile(n,t){const i=new Blob([n],{type:"application/vnd.openxmlformats-officedocument.spreadsheetml.sheet;charset=UTF-8"});z.saveAs(i,t+(new Date).getTime()+".xlsx")}exportToExcel(){let n=[];this.customersData.forEach(i=>{n.push({Name:i.name,"Phone Number":i.phone_number,Address:i.address,Notes:i.notes})}),this.exportAsConfig.type=this.downloadAs,this.exportAsConfig.elementIdOrContent="<table><thead><tr><th>Name</th><th>Balance Amount</th><th>Paid Amount</th></tr></thead><tbody><tr><td>Rajesh</td><td>1500</td><td>500</td></tr><tr><td>Customer1</td><td>0</td><td>0</td></tr></tbody></table>",this.exportAsConfig.options={margins:{top:"50"}},this.exportAsService.save(this.exportAsConfig,"customers").subscribe(()=>{})}downloadFile(n,t){const i=(window.URL||window.webkitURL).createObjectURL(n);var m=document.createElement("a");m.href=window.URL.createObjectURL(n),m.download=t+".pdf",m.click(),setTimeout(()=>{window.URL.revokeObjectURL(i)},1e3)}reset(){this.validateForm.controls.name.reset(),this.validateForm.controls.phoneNumber.reset(),this.validateForm.controls.address.reset(),this.validateForm.controls.notes.reset(),this.edit=!1,document.getElementById("customerName")?.focus()}editCustomer(n){this.edit=!0,this.customerId=n._id,this.validateForm.controls.phoneNumber.setValue(n.phone_number),this.validateForm.controls.name.setValue(n.name),this.validateForm.controls.notes.setValue(n.notes),this.validateForm.controls.address.setValue(n.address)}deleteConfirm(n){this.mainService.removeCustomer(n).subscribe(t=>{this.loading=!1,t&&t.success?(this.message.create("success",t.message),this.getCustomers()):t.success||this.message.create("warning",t.message)},t=>{console.log("get customers err ",t),this.loading=!1,t&&t.error&&!t.error.success&&1e3===t.error.code&&(this.message.create("error",t.error.message),sessionStorage.clear(),this.router.navigateByUrl("/login"))})}cancel(){}onPageSizeChange(n){this.pageSize=n,this.getCustomers()}onPageChange(n){this.index=n,this.getCustomers()}}return s.\u0275fac=function(n){return new(n||s)(e.Y36(p.QS),e.Y36(f.dD),e.Y36(y.J),e.Y36(S.f),e.Y36(g.F0))},s.\u0275cmp=e.Xpm({type:s,selectors:[["app-customer"]],decls:17,vars:6,consts:[[1,"customer-form"],["nz-row",""],["nz-col","","nzSpan","24"],[1,"text-center"],["nz-col","","nzSpan","12"],["nz-form","",3,"formGroup","ngSubmit",4,"ngIf"],["nz-tooltip","","nzTooltipTitle","Export as Excel",3,"click"],["nz-icon","","nzType","file-excel","nzTheme","fill"],[3,"nzData","nzLoading","nzShowPagination",4,"ngIf"],[1,"text-right"],[3,"nzPageIndex","nzTotal","nzShowSizeChanger","nzPageSize","nzPageIndexChange","nzPageSizeChange"],["nz-form","",3,"formGroup","ngSubmit"],["nzFor","customerName","nzRequired","",3,"nzSm","nzXs"],["nzErrorTip","Please input your name!",3,"nzSm","nzXs"],["nz-input","","id","customerName","formControlName","name","placeholder","Name","autocomplete","off"],["nzFor","phoneNumber",3,"nzSm","nzXs"],["nzErrorTip","Please input your phone number!",3,"nzSm","nzXs","nzValidateStatus"],[3,"nzAddOnBefore"],["addOnBeforeTemplate",""],["formControlName","phoneNumber","id","'phoneNumber'","nz-input","","autocomplete","off",3,"maxlength"],["nzFor","address",3,"nzSm","nzXs"],["nzErrorTip","Please input your address!",3,"nzSm","nzXs","nzValidateStatus"],[1,"ant-input-affix-wrapper-textarea-with-clear-btn",3,"nzSuffix"],["nz-input","","formControlName","address","placeholder","Address"],["textAreaClearTpl",""],["nzFor","notes",3,"nzSm","nzXs"],["nzErrorTip","Please input your notes!",3,"nzSm","nzXs","nzValidateStatus"],["nz-input","","formControlName","notes","placeholder","Notes"],["textAreaClearNotes",""],["nz-row","",1,"register-area"],[3,"nzSpan","nzOffset"],["nz-button","","nzType","primary",3,"disabled"],["nz-button","","nzType","default",3,"click"],["formControlName","phoneNumberPrefix","nzDisabled","",1,"phone-select"],["nzLabel","+91","nzValue","+91"],["nz-icon","","class","ant-input-clear-icon","nzTheme","fill","nzType","close-circle",3,"click",4,"ngIf"],["nz-icon","","nzTheme","fill","nzType","close-circle",1,"ant-input-clear-icon",3,"click"],[3,"nzData","nzLoading","nzShowPagination"],["customerTable",""],[4,"ngFor","ngForOf"],[3,"click",4,"ngIf"],["nz-popconfirm","","nzPopconfirmTitle","Are you sure delete this Customer","nzPopconfirmPlacement","bottom",3,"nzOnConfirm","nzOnCancel",4,"ngIf"],[3,"click"],["nz-icon","","nzType","edit","nzTheme","fill"],["nz-popconfirm","","nzPopconfirmTitle","Are you sure delete this Customer","nzPopconfirmPlacement","bottom",3,"nzOnConfirm","nzOnCancel"],["nz-icon","","nzType","delete","nzTheme","fill"]],template:function(n,t){1&n&&(e.TgZ(0,"div",0)(1,"div",1)(2,"div",2)(3,"h2",3),e._uU(4,"Customers"),e.qZA()()(),e.TgZ(5,"div",1)(6,"div",4),e.YNc(7,L,38,28,"form",5),e.qZA(),e.TgZ(8,"div",4)(9,"div")(10,"a",6),e.NdJ("click",function(){return t.exportToExcel()}),e._UZ(11,"span",7),e.qZA()(),e.YNc(12,w,16,4,"nz-table",8),e.TgZ(13,"div",9),e._UZ(14,"br"),e.TgZ(15,"nz-pagination",10),e.NdJ("nzPageIndexChange",function(m){return t.onPageChange(m)})("nzPageSizeChange",function(m){return t.onPageSizeChange(m)}),e.qZA(),e._UZ(16,"br"),e.qZA()()()()),2&n&&(e.xp6(7),e.Q6J("ngIf","admin"===t.userinfo.username||t.userinfo.apps.customer&&t.userinfo.apps.customer.isEdit),e.xp6(5),e.Q6J("ngIf",t.customersData),e.xp6(3),e.Q6J("nzPageIndex",t.index)("nzTotal",t.total)("nzShowSizeChanger",!0)("nzPageSize",t.pageSize))},dependencies:[x.sg,x.O5,r.SY,a.Ls,u.t3,u.SK,l.Lr,l.Nx,l.iK,l.Fd,p._Y,p.Fj,p.JJ,p.JL,p.nD,p.sg,p.u,c.Zp,c.gB,c.ke,F.Ip,F.Vq,N.ix,T.w,E.dQ,h.N8,h.Uo,h._C,h.Om,h.p0,h.$Z,v.JW,P.dE],styles:["[nz-form][_ngcontent-%COMP%]{max-width:600px}.phone-select[_ngcontent-%COMP%]{width:70px}.register-are[_ngcontent-%COMP%]{margin-bottom:8px}.customer-form[_ngcontent-%COMP%]{margin-top:20px}.text-center[_ngcontent-%COMP%]{text-align:center!important}.text-right[_ngcontent-%COMP%]{text-align:right!important}"]}),s})(),title:"S S T | Customers"},{path:"bill",loadChildren:()=>Promise.all([o.e(439),o.e(592),o.e(595)]).then(o.bind(o,31595)).then(s=>s.BillModule),title:"S S T | Customer Bills"},{path:"farmer",loadChildren:()=>Promise.all([o.e(592),o.e(91)]).then(o.bind(o,16091)).then(s=>s.FarmerModule),title:"S S T | Farmers"},{path:"vegetables",loadChildren:()=>o.e(360).then(o.bind(o,29360)).then(s=>s.VegetablesModule),title:"S S T | Vegetables"},{path:"customer-collection",loadChildren:()=>Promise.all([o.e(439),o.e(956)]).then(o.bind(o,73956)).then(s=>s.CustomerCollectionModule),title:"S S T | Customer Collections"},{path:"user_settings",loadChildren:()=>o.e(918).then(o.bind(o,91918)).then(s=>s.UserSettingsModule),title:"S S T | Users"},{path:"today_bills",loadChildren:()=>Promise.all([o.e(439),o.e(620)]).then(o.bind(o,88620)).then(s=>s.DayCollectionsModule),title:"S S T | Today Bills"},{path:"bill_print",loadChildren:()=>Promise.all([o.e(439),o.e(588)]).then(o.bind(o,588)).then(s=>s.BillPrintModule),title:"S S T | Bill Print"},{path:"statement",loadChildren:()=>Promise.all([o.e(439),o.e(850)]).then(o.bind(o,5850)).then(s=>s.StatementModule),title:"S S T | Statement"},{path:"farmer_bill",loadChildren:()=>Promise.all([o.e(439),o.e(592),o.e(928)]).then(o.bind(o,51928)).then(s=>s.FarmerBillModule),title:"S S T | Farmer Bill"},{path:"collections_report",loadChildren:()=>Promise.all([o.e(592),o.e(380)]).then(o.bind(o,67928)).then(s=>s.ReportCollectionsModule),title:"S S T | Report Collections"}];let V=(()=>{class s{}return s.\u0275fac=function(n){return new(n||s)},s.\u0275mod=e.oAB({type:s}),s.\u0275inj=e.cJS({imports:[g.Bz.forChild(Y),g.Bz]}),s})();var b=o(4973);let K=(()=>{class s{}return s.\u0275fac=function(n){return new(n||s)},s.\u0275mod=e.oAB({type:s}),s.\u0275inj=e.cJS({imports:[x.ez,V,b.m,b.m]}),s})()},94327:function(U,Z){var o,g;void 0!==(g="function"==typeof(o=function(){"use strict";function z(r,a,u){var l=new XMLHttpRequest;l.open("GET",r),l.responseType="blob",l.onload=function(){S(l.response,a,u)},l.onerror=function(){console.error("could not download file")},l.send()}function C(r){var a=new XMLHttpRequest;a.open("HEAD",r,!1);try{a.send()}catch{}return 200<=a.status&&299>=a.status}function e(r){try{r.dispatchEvent(new MouseEvent("click"))}catch{var a=document.createEvent("MouseEvents");a.initMouseEvent("click",!0,!0,window,0,0,0,80,20,!1,!1,!1,!1,0,null),r.dispatchEvent(a)}}var f="object"==typeof window&&window.window===window?window:"object"==typeof self&&self.self===self?self:"object"==typeof global&&global.global===global?global:void 0,y=f.navigator&&/Macintosh/.test(navigator.userAgent)&&/AppleWebKit/.test(navigator.userAgent)&&!/Safari/.test(navigator.userAgent),S=f.saveAs||("object"!=typeof window||window!==f?function(){}:"download"in HTMLAnchorElement.prototype&&!y?function(r,a,u){var l=f.URL||f.webkitURL,c=document.createElement("a");c.download=a=a||r.name||"download",c.rel="noopener","string"==typeof r?(c.href=r,c.origin===location.origin?e(c):C(c.href)?z(r,a,u):e(c,c.target="_blank")):(c.href=l.createObjectURL(r),setTimeout(function(){l.revokeObjectURL(c.href)},4e4),setTimeout(function(){e(c)},0))}:"msSaveOrOpenBlob"in navigator?function(r,a,u){if(a=a||r.name||"download","string"!=typeof r)navigator.msSaveOrOpenBlob(function p(r,a){return typeof a>"u"?a={autoBom:!1}:"object"!=typeof a&&(console.warn("Deprecated: Expected third argument to be a object"),a={autoBom:!a}),a.autoBom&&/^\s*(?:text\/\S*|application\/xml|\S*\/\S*\+xml)\s*;.*charset\s*=\s*utf-8/i.test(r.type)?new Blob(["\ufeff",r],{type:r.type}):r}(r,u),a);else if(C(r))z(r,a,u);else{var l=document.createElement("a");l.href=r,l.target="_blank",setTimeout(function(){e(l)})}}:function(r,a,u,l){if((l=l||open("","_blank"))&&(l.document.title=l.document.body.innerText="downloading..."),"string"==typeof r)return z(r,a,u);var c="application/octet-stream"===r.type,F=/constructor/i.test(f.HTMLElement)||f.safari,N=/CriOS\/[\d]+/.test(navigator.userAgent);if((N||c&&F||y)&&typeof FileReader<"u"){var T=new FileReader;T.onloadend=function(){var v=T.result;v=N?v:v.replace(/^data:[^;]*;/,"data:attachment/file;"),l?l.location.href=v:location=v,l=null},T.readAsDataURL(r)}else{var E=f.URL||f.webkitURL,h=E.createObjectURL(r);l?l.location=h:location.href=h,l=null,setTimeout(function(){E.revokeObjectURL(h)},4e4)}});f.saveAs=S.saveAs=S,U.exports=S})?o.apply(Z,[]):o)&&(U.exports=g)}}]);