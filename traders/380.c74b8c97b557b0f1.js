"use strict";(self.webpackChunktraders=self.webpackChunktraders||[]).push([[380],{67928:(E,d,s)=>{s.r(d),s.d(d,{ReportCollectionsModule:()=>M});var c=s(36895),f=s(4973),p=s(64575),i=s(90433),h=s(15439),t=s(94650),_=s(49651),v=s(32566),C=s(30901),x=s(31883),Z=s(21102),z=s(73679),m=s(36704),u=s(35635),g=s(38231),S=s(66616),A=s(47044),T=s(21811),F=s(37096),l=s(44688);function b(n,a){if(1&n&&t._UZ(0,"nz-option",24),2&n){const e=a.$implicit;t.Q6J("nzLabel",e)("nzValue",e)}}function y(n,a){1&n&&(t.TgZ(0,"nz-form-item")(1,"nz-form-label",25)(2,"span"),t._uU(3,"Spent Amount"),t.qZA()(),t.TgZ(4,"nz-form-control",7),t._UZ(5,"nz-input-number",26),t.qZA()()),2&n&&(t.xp6(1),t.Q6J("nzSm",6)("nzXs",24),t.xp6(3),t.Q6J("nzSm",14)("nzXs",24),t.xp6(1),t.Q6J("nzMin",1)("nzStep",1))}function J(n,a){if(1&n&&t._UZ(0,"nz-option",24),2&n){const e=a.$implicit;t.Q6J("nzLabel",e.name)("nzValue",e)}}function N(n,a){if(1&n&&(t.TgZ(0,"table",27)(1,"tr")(2,"td")(3,"nz-form-item",28)(4,"nz-form-label",29)(5,"span"),t._uU(6,"Farmer"),t.qZA()(),t.TgZ(7,"nz-form-control",9)(8,"nz-select",30),t.YNc(9,J,1,2,"nz-option",11),t.qZA()()()(),t.TgZ(10,"td")(11,"nz-form-item",31)(12,"nz-form-label",32)(13,"span"),t._uU(14,"Spent Amount"),t.qZA()(),t.TgZ(15,"nz-form-control",7),t._UZ(16,"nz-input-number",26),t.qZA()()()()()),2&n){const e=t.oxw();t.xp6(4),t.Q6J("nzSm",6)("nzXs",24),t.xp6(3),t.Q6J("nzSm",14)("nzXs",24),t.xp6(1),t.Q6J("nzAutoFocus",!0),t.xp6(1),t.Q6J("ngForOf",e.farmersData),t.xp6(3),t.Q6J("nzSm",6)("nzXs",24),t.xp6(3),t.Q6J("nzSm",14)("nzXs",24),t.xp6(1),t.Q6J("nzMin",1)("nzStep",1)}}function R(n,a){if(1&n){const e=t.EpF();t.TgZ(0,"span",34),t.NdJ("click",function(){t.CHM(e);const r=t.oxw(2);return t.KtG(r.clearfield("notes"))}),t.qZA()}}function U(n,a){if(1&n&&t.YNc(0,R,1,0,"span",33),2&n){const e=t.oxw();t.Q6J("ngIf",e.validateForm.controls.notes.value)}}function Q(n,a){if(1&n&&(t.TgZ(0,"tr")(1,"td"),t._uU(2),t.qZA(),t.TgZ(3,"td"),t._uU(4),t.qZA(),t.TgZ(5,"td"),t._uU(6),t.qZA(),t.TgZ(7,"td"),t._uU(8),t.qZA(),t.TgZ(9,"td"),t._uU(10),t.qZA(),t.TgZ(11,"td"),t._uU(12),t.qZA()()),2&n){const e=a.$implicit;t.xp6(2),t.Oqu(e.created_name),t.xp6(2),t.Oqu(e.amount),t.xp6(2),t.Oqu(e.date),t.xp6(2),t.Oqu(e.reason_type),t.xp6(2),t.Oqu(e.spent_amount),t.xp6(2),t.Oqu(e.notes)}}function O(n,a){if(1&n&&(t.TgZ(0,"nz-table",35,36)(2,"thead")(3,"tr")(4,"th"),t._uU(5,"Name"),t.qZA(),t.TgZ(6,"th"),t._uU(7,"Amount"),t.qZA(),t.TgZ(8,"th"),t._uU(9,"Date"),t.qZA(),t.TgZ(10,"th"),t._uU(11,"Spent Reason"),t.qZA(),t.TgZ(12,"th"),t._uU(13,"Spent Amount"),t.qZA(),t.TgZ(14,"th"),t._uU(15,"Notes"),t.qZA()()(),t.TgZ(16,"tbody"),t.YNc(17,Q,13,6,"tr",37),t.qZA()()),2&n){const e=t.oxw();t.Q6J("nzData",e.collectionsData)("nzLoading",e.loading)("nzShowPagination",!1),t.xp6(17),t.Q6J("ngForOf",e.collectionsData)}}const q=[{path:"",component:(()=>{class n{constructor(e,o,r,Y,P,D){this.fb=e,this.message=o,this.mainService=r,this.exportAsService=Y,this.router=P,this.farmerService=D,this.collectionsData=[],this.sort=["ascend"],this.listOfColumns=[{name:"Name"},{phoneNumber:"Phone Number"},{address:"Address"},{notes:"Note"}],this.index=1,this.total=0,this.pageSize=10,this.loading=!1,this.edit=!1,this.downloadAs="pdf",this.exportAsConfig={type:"pdf",elementIdOrContent:"sampleTable"},this.customers=[],this.reasonTypes=["Petrol","Farmer","Transport","Cooli"],this.userinfo=this.mainService.getLoggedInUser(),this.validateForm=this.fb.group({amount:[null,[i.kI.required]],reason_type:[null],reason_amount:[null],notes:[null],farmer:[null]}),this.validateForm.controls.reason_type.valueChanges.subscribe(I=>{console.log("data: ",I),this.validateForm.controls.reason_amount.reset(),this.validateForm.controls.farmer.reset()})}ngOnInit(){this.getAllFarmers(),this.getcollection_reports()}submitForm(){const o={date:h(new Date).format("DD-MM-YYYY"),reason_type:this.validateForm.value.reason_type,farmer_id:"Farmer"===this.validateForm.value.reason_type?this.validateForm.value.farmer._id:"",amount:this.validateForm.value.amount,spent_amount:this.validateForm.value.reason_amount,notes:this.validateForm.value.notes};this.mainService.createCollectionReport(o).subscribe(r=>{this.message.create("success",r.message),this.reset(),this.getcollection_reports()},r=>{console.log("get customers err ",r),this.loading=!1,this.mainService.spinning.emit(!1),this.getcollection_reports()})}clearfield(e){this.validateForm.controls[e].reset()}reset(){this.validateForm.controls.amount.reset(),this.validateForm.controls.reason_type.reset(),this.validateForm.controls.reason_amount.reset(),this.validateForm.controls.farmer.reset(),this.validateForm.controls.notes.reset()}exportToExcel(){let e=[];this.collectionsData.forEach(r=>{e.push({Name:r.name,"Phone Number":r.phone_number,Address:r.address,Notes:r.notes})}),this.exportAsConfig.type=this.downloadAs,this.exportAsConfig.elementIdOrContent="<table><thead><tr><th>Name</th><th>Balance Amount</th><th>Paid Amount</th></tr></thead><tbody><tr><td>Rajesh</td><td>1500</td><td>500</td></tr><tr><td>Customer1</td><td>0</td><td>0</td></tr></tbody></table>",this.exportAsConfig.options={margins:{top:"50"}},this.exportAsService.save(this.exportAsConfig,"customers").subscribe(()=>{})}editCustomer(e){this.edit=!0,this.customerId=e._id,this.validateForm.controls.phoneNumber.setValue(e.phone_number),this.validateForm.controls.name.setValue(e.name),this.validateForm.controls.notes.setValue(e.notes),this.validateForm.controls.address.setValue(e.address)}deleteConfirm(e){this.mainService.removeCustomer(e).subscribe(o=>{this.loading=!1,o&&o.success?this.message.create("success",o.message):o.success||this.message.create("warning",o.message)},o=>{console.log("get customers err ",o),this.loading=!1,o&&o.error&&!o.error.success&&1e3===o.error.code&&(this.message.create("error",o.error.message),sessionStorage.clear(),this.router.navigateByUrl("/login"))})}cancel(){}onPageSizeChange(e){this.pageSize=e}onPageChange(e){this.index=e}getAllFarmers(){document.getElementById("farmerName")?.focus(),this.farmerService.getFarmers({}).subscribe(o=>{this.farmersData=o.data,this.total=o.total},o=>{console.log("get farmers err ",o),this.farmersData=[],o&&o.error&&!o.error.success&&1e3===o.error.code&&(this.message.create("error",o.error.message),sessionStorage.clear(),this.router.navigateByUrl("/login"))})}getcollection_reports(){this.mainService.getcollection_reports({}).subscribe(o=>{console.log("data: ",o),this.collectionsData=o},o=>{console.log("get collection_reports err ",o),o&&o.error&&!o.error.success&&1e3===o.error.code&&(this.message.create("error",o.error.message),sessionStorage.clear(),this.router.navigateByUrl("/login"))})}}return n.\u0275fac=function(e){return new(e||n)(t.Y36(i.QS),t.Y36(_.dD),t.Y36(v.J),t.Y36(C.f),t.Y36(p.F0),t.Y36(x.y))},n.\u0275cmp=t.Xpm({type:n,selectors:[["app-report-collections"]],decls:40,vars:26,consts:[[1,"customer-form"],["nz-row",""],["nz-col","","nzSpan","24"],[1,"text-center"],["nz-col","","nzSpan","12"],["nz-form","",3,"formGroup","ngSubmit"],["nzFor","amount","nzRequired","",3,"nzSm","nzXs"],["nzErrorTip","Enter Amount",3,"nzSm","nzXs"],["id","amount","formControlName","amount",3,"nzMin","nzStep"],[3,"nzSm","nzXs"],["nzShowSearch","","nzAllowClear","","formControlName","reason_type",3,"nzAutoFocus"],[3,"nzLabel","nzValue",4,"ngFor","ngForOf"],[4,"ngIf"],["class","reason_type_custom",4,"ngIf"],["nzFor","notes",3,"nzSm","nzXs"],["nzErrorTip","Please input your notes!",3,"nzSm","nzXs","nzValidateStatus"],[1,"ant-input-affix-wrapper-textarea-with-clear-btn",3,"nzSuffix"],["nz-input","","formControlName","notes","placeholder","Notes"],["textAreaClearNotes",""],["nz-row","",1,"register-area"],[3,"nzSpan","nzOffset"],["nz-button","","nzType","primary",3,"disabled"],["nz-button","","nzType","default",3,"click"],[3,"nzData","nzLoading","nzShowPagination",4,"ngIf"],[3,"nzLabel","nzValue"],["nzFor","reason_amount",3,"nzSm","nzXs"],["id","reason_amount","formControlName","reason_amount",3,"nzMin","nzStep"],[1,"reason_type_custom"],[2,"width","350px"],["nzRequired","",3,"nzSm","nzXs"],["nzShowSearch","","nzAllowClear","","formControlName","farmer",3,"nzAutoFocus"],[2,"width","445px"],["nzFor","reason_amount","nzRequired","",3,"nzSm","nzXs"],["nz-icon","","class","ant-input-clear-icon","nzTheme","fill","nzType","close-circle",3,"click",4,"ngIf"],["nz-icon","","nzTheme","fill","nzType","close-circle",1,"ant-input-clear-icon",3,"click"],[3,"nzData","nzLoading","nzShowPagination"],["customerTable",""],[4,"ngFor","ngForOf"]],template:function(e,o){if(1&e&&(t.TgZ(0,"div",0)(1,"div",1)(2,"div",2)(3,"h2",3),t._uU(4,"Collection Report"),t.qZA()()(),t.TgZ(5,"div",1)(6,"div",4)(7,"form",5),t.NdJ("ngSubmit",function(){return o.submitForm()}),t.TgZ(8,"nz-form-item")(9,"nz-form-label",6)(10,"span"),t._uU(11,"Amount"),t.qZA()(),t.TgZ(12,"nz-form-control",7),t._UZ(13,"nz-input-number",8),t.qZA()(),t.TgZ(14,"nz-form-item")(15,"nz-form-label",9)(16,"span"),t._uU(17,"Reason Type"),t.qZA()(),t.TgZ(18,"nz-form-control",9)(19,"nz-select",10),t.YNc(20,b,1,2,"nz-option",11),t.qZA()()(),t.YNc(21,y,6,6,"nz-form-item",12),t.YNc(22,N,17,12,"table",13),t.TgZ(23,"nz-form-item")(24,"nz-form-label",14),t._uU(25,"Notes"),t.qZA(),t.TgZ(26,"nz-form-control",15)(27,"nz-input-group",16),t._UZ(28,"textarea",17),t.qZA(),t.YNc(29,U,1,1,"ng-template",null,18,t.W1O),t.qZA()(),t.TgZ(31,"nz-form-item",19)(32,"nz-form-control",20)(33,"button",21),t._uU(34),t.qZA(),t._uU(35,"\xa0 "),t.TgZ(36,"button",22),t.NdJ("click",function(){return o.reset()}),t._uU(37,"Reset"),t.qZA()()()()(),t.TgZ(38,"div",4),t.YNc(39,O,18,4,"nz-table",23),t.qZA()()()),2&e){const r=t.MAs(30);t.xp6(7),t.Q6J("formGroup",o.validateForm),t.xp6(2),t.Q6J("nzSm",6)("nzXs",24),t.xp6(3),t.Q6J("nzSm",14)("nzXs",24),t.xp6(1),t.Q6J("nzMin",1)("nzStep",1),t.xp6(2),t.Q6J("nzSm",6)("nzXs",24),t.xp6(3),t.Q6J("nzSm",14)("nzXs",24),t.xp6(1),t.Q6J("nzAutoFocus",!0),t.xp6(1),t.Q6J("ngForOf",o.reasonTypes),t.xp6(1),t.Q6J("ngIf","Farmer"!==o.validateForm.controls.reason_type.value),t.xp6(1),t.Q6J("ngIf","Farmer"===o.validateForm.controls.reason_type.value),t.xp6(2),t.Q6J("nzSm",6)("nzXs",24),t.xp6(2),t.Q6J("nzSm",14)("nzXs",24)("nzValidateStatus",o.validateForm.controls.notes),t.xp6(1),t.Q6J("nzSuffix",r),t.xp6(5),t.Q6J("nzSpan",14)("nzOffset",6),t.xp6(1),t.Q6J("disabled",!o.validateForm.valid),t.xp6(1),t.Oqu(o.edit?"Update":"Submit"),t.xp6(5),t.Q6J("ngIf",o.collectionsData)}},dependencies:[c.sg,c.O5,Z.Ls,z.t3,z.SK,m.Lr,m.Nx,m.iK,m.Fd,i._Y,i.Fj,i.JJ,i.JL,i.sg,i.u,u.Zp,u.gB,u.ke,g.Ip,g.Vq,S.ix,A.w,T.dQ,F._V,l.N8,l.Uo,l._C,l.Om,l.p0,l.$Z],styles:["[nz-form][_ngcontent-%COMP%]{max-width:600px}.phone-select[_ngcontent-%COMP%]{width:70px}.register-are[_ngcontent-%COMP%]{margin-bottom:8px}.customer-form[_ngcontent-%COMP%]{margin-top:20px}.text-center[_ngcontent-%COMP%]{text-align:center!important}.text-right[_ngcontent-%COMP%]{text-align:right!important}.reason_type_custom[_ngcontent-%COMP%]{width:100%;margin-left:10%}"]}),n})()}];let X=(()=>{class n{}return n.\u0275fac=function(e){return new(e||n)},n.\u0275mod=t.oAB({type:n}),n.\u0275inj=t.cJS({imports:[p.Bz.forChild(q),p.Bz]}),n})(),M=(()=>{class n{}return n.\u0275fac=function(e){return new(e||n)},n.\u0275mod=t.oAB({type:n}),n.\u0275inj=t.cJS({imports:[c.ez,X,f.m]}),n})()}}]);